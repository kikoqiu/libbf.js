<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>scalar.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BigFloat.html">BigFloat</a><ul class='methods'><li data-type='method'><a href="BigFloat.html#abs">abs</a></li><li data-type='method'><a href="BigFloat.html#acos">acos</a></li><li data-type='method'><a href="BigFloat.html#add">add</a></li><li data-type='method'><a href="BigFloat.html#and">and</a></li><li data-type='method'><a href="BigFloat.html#asin">asin</a></li><li data-type='method'><a href="BigFloat.html#atan">atan</a></li><li data-type='method'><a href="BigFloat.html#atan2">atan2</a></li><li data-type='method'><a href="BigFloat.html#calc">calc</a></li><li data-type='method'><a href="BigFloat.html#calc2">calc2</a></li><li data-type='method'><a href="BigFloat.html#callFunc">callFunc</a></li><li data-type='method'><a href="BigFloat.html#ceil">ceil</a></li><li data-type='method'><a href="BigFloat.html#checkoprand">checkoprand</a></li><li data-type='method'><a href="BigFloat.html#checkstatus">checkstatus</a></li><li data-type='method'><a href="BigFloat.html#clone">clone</a></li><li data-type='method'><a href="BigFloat.html#cmp">cmp</a></li><li data-type='method'><a href="BigFloat.html#copy">copy</a></li><li data-type='method'><a href="BigFloat.html#cos">cos</a></li><li data-type='method'><a href="BigFloat.html#dispose">dispose</a></li><li data-type='method'><a href="BigFloat.html#div">div</a></li><li data-type='method'><a href="BigFloat.html#equals">equals</a></li><li data-type='method'><a href="BigFloat.html#exp">exp</a></li><li data-type='method'><a href="BigFloat.html#f64">f64</a></li><li data-type='method'><a href="BigFloat.html#floor">floor</a></li><li data-type='method'><a href="BigFloat.html#fpround">fpround</a></li><li data-type='method'><a href="BigFloat.html#fromNumber">fromNumber</a></li><li data-type='method'><a href="BigFloat.html#getEpsilon">getEpsilon</a></li><li data-type='method'><a href="BigFloat.html#geth">geth</a></li><li data-type='method'><a href="BigFloat.html#isAlmostZero">isAlmostZero</a></li><li data-type='method'><a href="BigFloat.html#isExactZero">isExactZero</a></li><li data-type='method'><a href="BigFloat.html#isFinit">isFinit</a></li><li data-type='method'><a href="BigFloat.html#isInExact">isInExact</a></li><li data-type='method'><a href="BigFloat.html#isNaN">isNaN</a></li><li data-type='method'><a href="BigFloat.html#isZero">isZero</a></li><li data-type='method'><a href="BigFloat.html#log">log</a></li><li data-type='method'><a href="BigFloat.html#mod">mod</a></li><li data-type='method'><a href="BigFloat.html#mul">mul</a></li><li data-type='method'><a href="BigFloat.html#neg">neg</a></li><li data-type='method'><a href="BigFloat.html#operatorEqual">operatorEqual</a></li><li data-type='method'><a href="BigFloat.html#operatorGreater">operatorGreater</a></li><li data-type='method'><a href="BigFloat.html#operatorGreaterEqual">operatorGreaterEqual</a></li><li data-type='method'><a href="BigFloat.html#operatorLess">operatorLess</a></li><li data-type='method'><a href="BigFloat.html#operatorLessEqual">operatorLessEqual</a></li><li data-type='method'><a href="BigFloat.html#operatorNotEqual">operatorNotEqual</a></li><li data-type='method'><a href="BigFloat.html#or">or</a></li><li data-type='method'><a href="BigFloat.html#pow">pow</a></li><li data-type='method'><a href="BigFloat.html#rem">rem</a></li><li data-type='method'><a href="BigFloat.html#round">round</a></li><li data-type='method'><a href="BigFloat.html#setEPSILON">setEPSILON</a></li><li data-type='method'><a href="BigFloat.html#setLOG2">setLOG2</a></li><li data-type='method'><a href="BigFloat.html#setMAX_VALUE">setMAX_VALUE</a></li><li data-type='method'><a href="BigFloat.html#setMIN_VALUE">setMIN_VALUE</a></li><li data-type='method'><a href="BigFloat.html#setPI">setPI</a></li><li data-type='method'><a href="BigFloat.html#setabs">setabs</a></li><li data-type='method'><a href="BigFloat.html#setacos">setacos</a></li><li data-type='method'><a href="BigFloat.html#setadd">setadd</a></li><li data-type='method'><a href="BigFloat.html#setand">setand</a></li><li data-type='method'><a href="BigFloat.html#setasin">setasin</a></li><li data-type='method'><a href="BigFloat.html#setatan">setatan</a></li><li data-type='method'><a href="BigFloat.html#setatan2">setatan2</a></li><li data-type='method'><a href="BigFloat.html#setceil">setceil</a></li><li data-type='method'><a href="BigFloat.html#setcos">setcos</a></li><li data-type='method'><a href="BigFloat.html#setdiv">setdiv</a></li><li data-type='method'><a href="BigFloat.html#setexp">setexp</a></li><li data-type='method'><a href="BigFloat.html#setfloor">setfloor</a></li><li data-type='method'><a href="BigFloat.html#setfpround">setfpround</a></li><li data-type='method'><a href="BigFloat.html#setlog">setlog</a></li><li data-type='method'><a href="BigFloat.html#setmod">setmod</a></li><li data-type='method'><a href="BigFloat.html#setmul">setmul</a></li><li data-type='method'><a href="BigFloat.html#setneg">setneg</a></li><li data-type='method'><a href="BigFloat.html#setor">setor</a></li><li data-type='method'><a href="BigFloat.html#setpow">setpow</a></li><li data-type='method'><a href="BigFloat.html#setrem">setrem</a></li><li data-type='method'><a href="BigFloat.html#setround">setround</a></li><li data-type='method'><a href="BigFloat.html#setsign">setsign</a></li><li data-type='method'><a href="BigFloat.html#setsin">setsin</a></li><li data-type='method'><a href="BigFloat.html#setsqrt">setsqrt</a></li><li data-type='method'><a href="BigFloat.html#setsub">setsub</a></li><li data-type='method'><a href="BigFloat.html#settan">settan</a></li><li data-type='method'><a href="BigFloat.html#settrunc">settrunc</a></li><li data-type='method'><a href="BigFloat.html#setxor">setxor</a></li><li data-type='method'><a href="BigFloat.html#sign">sign</a></li><li data-type='method'><a href="BigFloat.html#sin">sin</a></li><li data-type='method'><a href="BigFloat.html#sqrt">sqrt</a></li><li data-type='method'><a href="BigFloat.html#sub">sub</a></li><li data-type='method'><a href="BigFloat.html#tan">tan</a></li><li data-type='method'><a href="BigFloat.html#toBigInt">toBigInt</a></li><li data-type='method'><a href="BigFloat.html#toComplex">toComplex</a></li><li data-type='method'><a href="BigFloat.html#toFixed">toFixed</a></li><li data-type='method'><a href="BigFloat.html#toNumber">toNumber</a></li><li data-type='method'><a href="BigFloat.html#toString">toString</a></li><li data-type='method'><a href="BigFloat.html#toUint8Array">toUint8Array</a></li><li data-type='method'><a href="BigFloat.html#trunc">trunc</a></li><li data-type='method'><a href="BigFloat.html#visit">visit</a></li><li data-type='method'><a href="BigFloat.html#wraptypeh">wraptypeh</a></li><li data-type='method'><a href="BigFloat.html#xor">xor</a></li><li data-type='method'><a href="BigFloat.html#.fromString">fromString</a></li></ul></li><li><a href="BigFloat_BigFloat.html">BigFloat</a></li><li><a href="BigFraction.html">BigFraction</a><ul class='methods'><li data-type='method'><a href="BigFraction.html#abs">abs</a></li><li data-type='method'><a href="BigFraction.html#acos">acos</a></li><li data-type='method'><a href="BigFraction.html#acosh">acosh</a></li><li data-type='method'><a href="BigFraction.html#add">add</a></li><li data-type='method'><a href="BigFraction.html#asin">asin</a></li><li data-type='method'><a href="BigFraction.html#asinh">asinh</a></li><li data-type='method'><a href="BigFraction.html#atan">atan</a></li><li data-type='method'><a href="BigFraction.html#atanh">atanh</a></li><li data-type='method'><a href="BigFraction.html#cmp">cmp</a></li><li data-type='method'><a href="BigFraction.html#cos">cos</a></li><li data-type='method'><a href="BigFraction.html#cosh">cosh</a></li><li data-type='method'><a href="BigFraction.html#div">div</a></li><li data-type='method'><a href="BigFraction.html#equals">equals</a></li><li data-type='method'><a href="BigFraction.html#exp">exp</a></li><li data-type='method'><a href="BigFraction.html#floor">floor</a></li><li data-type='method'><a href="BigFraction.html#isAlmostZero">isAlmostZero</a></li><li data-type='method'><a href="BigFraction.html#isNaN">isNaN</a></li><li data-type='method'><a href="BigFraction.html#isZero">isZero</a></li><li data-type='method'><a href="BigFraction.html#log">log</a></li><li data-type='method'><a href="BigFraction.html#mul">mul</a></li><li data-type='method'><a href="BigFraction.html#neg">neg</a></li><li data-type='method'><a href="BigFraction.html#operatorAdd">operatorAdd</a></li><li data-type='method'><a href="BigFraction.html#operatorDiv">operatorDiv</a></li><li data-type='method'><a href="BigFraction.html#operatorEqual">operatorEqual</a></li><li data-type='method'><a href="BigFraction.html#operatorGreater">operatorGreater</a></li><li data-type='method'><a href="BigFraction.html#operatorGreaterEqual">operatorGreaterEqual</a></li><li data-type='method'><a href="BigFraction.html#operatorLess">operatorLess</a></li><li data-type='method'><a href="BigFraction.html#operatorLessEqual">operatorLessEqual</a></li><li data-type='method'><a href="BigFraction.html#operatorMul">operatorMul</a></li><li data-type='method'><a href="BigFraction.html#operatorNeg">operatorNeg</a></li><li data-type='method'><a href="BigFraction.html#operatorNotEqual">operatorNotEqual</a></li><li data-type='method'><a href="BigFraction.html#operatorPow">operatorPow</a></li><li data-type='method'><a href="BigFraction.html#operatorSub">operatorSub</a></li><li data-type='method'><a href="BigFraction.html#pow">pow</a></li><li data-type='method'><a href="BigFraction.html#sin">sin</a></li><li data-type='method'><a href="BigFraction.html#sinh">sinh</a></li><li data-type='method'><a href="BigFraction.html#sqrt">sqrt</a></li><li data-type='method'><a href="BigFraction.html#sub">sub</a></li><li data-type='method'><a href="BigFraction.html#tan">tan</a></li><li data-type='method'><a href="BigFraction.html#tanh">tanh</a></li><li data-type='method'><a href="BigFraction.html#toBigFloat">toBigFloat</a></li><li data-type='method'><a href="BigFraction.html#toNumber">toNumber</a></li><li data-type='method'><a href="BigFraction.html#toString">toString</a></li><li data-type='method'><a href="BigFraction.html#.fromString">fromString</a></li></ul></li><li><a href="BigFraction_BigFraction.html">BigFraction</a></li><li><a href="Complex.html">Complex</a><ul class='methods'><li data-type='method'><a href="Complex.html#abs">abs</a></li><li data-type='method'><a href="Complex.html#acos">acos</a></li><li data-type='method'><a href="Complex.html#acosh">acosh</a></li><li data-type='method'><a href="Complex.html#add">add</a></li><li data-type='method'><a href="Complex.html#arg">arg</a></li><li data-type='method'><a href="Complex.html#asin">asin</a></li><li data-type='method'><a href="Complex.html#asinh">asinh</a></li><li data-type='method'><a href="Complex.html#atan">atan</a></li><li data-type='method'><a href="Complex.html#atanh">atanh</a></li><li data-type='method'><a href="Complex.html#conj">conj</a></li><li data-type='method'><a href="Complex.html#cos">cos</a></li><li data-type='method'><a href="Complex.html#cosh">cosh</a></li><li data-type='method'><a href="Complex.html#div">div</a></li><li data-type='method'><a href="Complex.html#equals">equals</a></li><li data-type='method'><a href="Complex.html#exp">exp</a></li><li data-type='method'><a href="Complex.html#isAlmostZero">isAlmostZero</a></li><li data-type='method'><a href="Complex.html#isZero">isZero</a></li><li data-type='method'><a href="Complex.html#log">log</a></li><li data-type='method'><a href="Complex.html#mul">mul</a></li><li data-type='method'><a href="Complex.html#neg">neg</a></li><li data-type='method'><a href="Complex.html#pow">pow</a></li><li data-type='method'><a href="Complex.html#sin">sin</a></li><li data-type='method'><a href="Complex.html#sinh">sinh</a></li><li data-type='method'><a href="Complex.html#sqrt">sqrt</a></li><li data-type='method'><a href="Complex.html#sub">sub</a></li><li data-type='method'><a href="Complex.html#tan">tan</a></li><li data-type='method'><a href="Complex.html#tanh">tanh</a></li><li data-type='method'><a href="Complex.html#toString">toString</a></li><li data-type='method'><a href="Complex.html#.fromPolar">fromPolar</a></li><li data-type='method'><a href="Complex.html#.fromString">fromString</a></li></ul></li><li><a href="Poly.html">Poly</a><ul class='methods'><li data-type='method'><a href="Poly.html#acos">acos</a></li><li data-type='method'><a href="Poly.html#add">add</a></li><li data-type='method'><a href="Poly.html#asin">asin</a></li><li data-type='method'><a href="Poly.html#atan">atan</a></li><li data-type='method'><a href="Poly.html#cos">cos</a></li><li data-type='method'><a href="Poly.html#degree">degree</a></li><li data-type='method'><a href="Poly.html#deriv">deriv</a></li><li data-type='method'><a href="Poly.html#div">div</a></li><li data-type='method'><a href="Poly.html#equals">equals</a></li><li data-type='method'><a href="Poly.html#eval">eval</a></li><li data-type='method'><a href="Poly.html#exp">exp</a></li><li data-type='method'><a href="Poly.html#integ">integ</a></li><li data-type='method'><a href="Poly.html#log">log</a></li><li data-type='method'><a href="Poly.html#mul">mul</a></li><li data-type='method'><a href="Poly.html#neg">neg</a></li><li data-type='method'><a href="Poly.html#operatorAdd">operatorAdd</a></li><li data-type='method'><a href="Poly.html#operatorDiv">operatorDiv</a></li><li data-type='method'><a href="Poly.html#operatorMul">operatorMul</a></li><li data-type='method'><a href="Poly.html#operatorNeg">operatorNeg</a></li><li data-type='method'><a href="Poly.html#operatorPow">operatorPow</a></li><li data-type='method'><a href="Poly.html#operatorSub">operatorSub</a></li><li data-type='method'><a href="Poly.html#pow">pow</a></li><li data-type='method'><a href="Poly.html#powSeries">powSeries</a></li><li data-type='method'><a href="Poly.html#sin">sin</a></li><li data-type='method'><a href="Poly.html#sub">sub</a></li><li data-type='method'><a href="Poly.html#tan">tan</a></li><li data-type='method'><a href="Poly.html#toString">toString</a></li><li data-type='method'><a href="Poly.html#valuation">valuation</a></li><li data-type='method'><a href="Poly.html#.O">O</a></li><li data-type='method'><a href="Poly.html#.X">X</a></li></ul></li><li><a href="Scalar.html">Scalar</a><ul class='methods'><li data-type='method'><a href="Scalar.html#abs">abs</a></li><li data-type='method'><a href="Scalar.html#acos">acos</a></li><li data-type='method'><a href="Scalar.html#acosh">acosh</a></li><li data-type='method'><a href="Scalar.html#add">add</a></li><li data-type='method'><a href="Scalar.html#asin">asin</a></li><li data-type='method'><a href="Scalar.html#asinh">asinh</a></li><li data-type='method'><a href="Scalar.html#atan">atan</a></li><li data-type='method'><a href="Scalar.html#atanh">atanh</a></li><li data-type='method'><a href="Scalar.html#cmp">cmp</a></li><li data-type='method'><a href="Scalar.html#cos">cos</a></li><li data-type='method'><a href="Scalar.html#cosh">cosh</a></li><li data-type='method'><a href="Scalar.html#div">div</a></li><li data-type='method'><a href="Scalar.html#equals">equals</a></li><li data-type='method'><a href="Scalar.html#exp">exp</a></li><li data-type='method'><a href="Scalar.html#isAlmostZero">isAlmostZero</a></li><li data-type='method'><a href="Scalar.html#isZero">isZero</a></li><li data-type='method'><a href="Scalar.html#log">log</a></li><li data-type='method'><a href="Scalar.html#mul">mul</a></li><li data-type='method'><a href="Scalar.html#neg">neg</a></li><li data-type='method'><a href="Scalar.html#operatorAdd">operatorAdd</a></li><li data-type='method'><a href="Scalar.html#operatorDiv">operatorDiv</a></li><li data-type='method'><a href="Scalar.html#operatorMul">operatorMul</a></li><li data-type='method'><a href="Scalar.html#operatorNeg">operatorNeg</a></li><li data-type='method'><a href="Scalar.html#operatorPow">operatorPow</a></li><li data-type='method'><a href="Scalar.html#operatorSub">operatorSub</a></li><li data-type='method'><a href="Scalar.html#pow">pow</a></li><li data-type='method'><a href="Scalar.html#sin">sin</a></li><li data-type='method'><a href="Scalar.html#sinh">sinh</a></li><li data-type='method'><a href="Scalar.html#sqrt">sqrt</a></li><li data-type='method'><a href="Scalar.html#sub">sub</a></li><li data-type='method'><a href="Scalar.html#tan">tan</a></li><li data-type='method'><a href="Scalar.html#tanh">tanh</a></li><li data-type='method'><a href="Scalar.html#toString">toString</a></li><li data-type='method'><a href="Scalar.html#.fromString">fromString</a></li><li data-type='method'><a href="Scalar.html#.getLevel">getLevel</a></li><li data-type='method'><a href="Scalar.html#.promote">promote</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#E">E</a></li><li><a href="global.html#Flags">Flags</a></li><li><a href="global.html#O">O</a></li><li><a href="global.html#PI">PI</a></li><li><a href="global.html#X">X</a></li><li><a href="global.html#abs">abs</a></li><li><a href="global.html#acos">acos</a></li><li><a href="global.html#asin">asin</a></li><li><a href="global.html#atan">atan</a></li><li><a href="global.html#atan2">atan2</a></li><li><a href="global.html#bf">bf</a></li><li><a href="global.html#bigIntSqrt">bigIntSqrt</a></li><li><a href="global.html#ceil">ceil</a></li><li><a href="global.html#complex">complex</a></li><li><a href="global.html#cos">cos</a></li><li><a href="global.html#decimal_precision">decimal_precision</a></li><li><a href="global.html#exp">exp</a></li><li><a href="global.html#floor">floor</a></li><li><a href="global.html#fminbnd">fminbnd</a></li><li><a href="global.html#formatDecimal">formatDecimal</a></li><li><a href="global.html#fpround">fpround</a></li><li><a href="global.html#frac">frac</a></li><li><a href="global.html#fromDouble">fromDouble</a></li><li><a href="global.html#fzero">fzero</a></li><li><a href="global.html#gc_ele_limit">gc_ele_limit</a></li><li><a href="global.html#gcd">gcd</a></li><li><a href="global.html#globalFlag">globalFlag</a></li><li><a href="global.html#half">half</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#is_ready">is_ready</a></li><li><a href="global.html#libbf">libbf</a></li><li><a href="global.html#log">log</a></li><li><a href="global.html#max">max</a></li><li><a href="global.html#minus_one">minus_one</a></li><li><a href="global.html#neg">neg</a></li><li><a href="global.html#ode45">ode45</a></li><li><a href="global.html#one">one</a></li><li><a href="global.html#poly">poly</a></li><li><a href="global.html#polyStr">polyStr</a></li><li><a href="global.html#polyfit">polyfit</a></li><li><a href="global.html#polyval">polyval</a></li><li><a href="global.html#pop_precision">pop_precision</a></li><li><a href="global.html#pow">pow</a></li><li><a href="global.html#precision">precision</a></li><li><a href="global.html#push_decimal_precision">push_decimal_precision</a></li><li><a href="global.html#push_precision">push_precision</a></li><li><a href="global.html#romberg">romberg</a></li><li><a href="global.html#roots">roots</a></li><li><a href="global.html#round">round</a></li><li><a href="global.html#scalar">scalar</a></li><li><a href="global.html#setGlobalFlag">setGlobalFlag</a></li><li><a href="global.html#setPrecision">setPrecision</a></li><li><a href="global.html#setThrowExceptionOnInvalidOp">setThrowExceptionOnInvalidOp</a></li><li><a href="global.html#set_gc_ele_limit">set_gc_ele_limit</a></li><li><a href="global.html#sign">sign</a></li><li><a href="global.html#sin">sin</a></li><li><a href="global.html#solveLinearSystem">solveLinearSystem</a></li><li><a href="global.html#sqrt">sqrt</a></li><li><a href="global.html#tan">tan</a></li><li><a href="global.html#three">three</a></li><li><a href="global.html#throwExceptionOnInvalidOp">throwExceptionOnInvalidOp</a></li><li><a href="global.html#trunc">trunc</a></li><li><a href="global.html#two">two</a></li><li><a href="global.html#zero">zero</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">scalar.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { bf, BigFraction, Complex, BigFloat} from "./bf.js";

/**
 * Scalar Wrapper Class.
 * Manages dispatching and type promotion between BigFraction, BigFloat, and Complex.
 * 
 * Hierarchy:
 * Level 0: BigFraction (Rational)
 * Level 1: BigFloat (Real/Float)
 * Level 2: Complex (Complex)
 * 
 * @property {BigFraction|BigFloat|Complex} value - The underlying numeric value.
 * @property {number} level - The type promotion level (0, 1, or 2).
 */
export class Scalar {
    /**
     * @param {number|bigint|string|BigFraction|BigFloat|Complex|Scalar} v 
     */
    constructor(v) {
        if (v instanceof Scalar) {
            this.value = v.value;
            this.level = v.level;
            return;
        }

        const type = typeof v;

        if (type === 'number') {
            if (Number.isInteger(v)) {
                this.value = new BigFraction(v);
                this.level = 0;
            } else {
                this.value = bf(v); // bf is assumed to be the BigFloat factory
                this.level = 1;
            }
        } 
        else if (type === 'bigint') {
            this.value = new BigFraction(v);
            this.level = 0;
        } 
        else if (type === 'string') {
            const parsed = Scalar.fromString(v);
            this.value = parsed.value;
            this.level = parsed.level;
        } 
        else {
            // v is already a math object (Complex, BigFloat, or BigFraction)
            this.value = v;
            this.level = Scalar.getLevel(v);
        }
    }

    /**
     * Determine the level of a raw math object.
     * @param {any} v The value to check.
     * @returns {number} The promotion level.
     */
    static getLevel(v) {
        if (v instanceof Complex) return 2;
        if (v instanceof BigFloat) return 1;
        if (v instanceof BigFraction) return 0;
        return 1;
    }

    /**
     * Promotes a raw value to the target level.
     * @param {any} v The value to promote.
     * @param {number} targetLevel The target promotion level.
     * @returns {any} The promoted value.
     */
    static promote(v, targetLevel) {
        const currentLevel = Scalar.getLevel(v);
        if (currentLevel >= targetLevel) return v;

        if (targetLevel === 1) {
            // Level 0 -> 1: BigFraction to BigFloat
            return v.toBigFloat ? v.toBigFloat() : bf(v.toString());
        }
        if (targetLevel === 2) {
            // Level 0/1 -> 2: Scalar to Complex
            const realPart = Scalar.promote(v, 1);
            return new Complex(realPart, 0);
        }
        return v;
    }

    // --- Arithmetic Operators ---
    /**
     * Internal dispatcher for binary operations.
     * @private
     * @param {Scalar|any} a - The first operand.
     * @param {Scalar|any} b - The second operand.
     * @param {string} opName - The name of the operation.
     * @returns {Scalar} The result of the operation.
     */
    static _binaryOp(a, b, opName) {
        const va = a instanceof Scalar ? a.value : a;
        const vb = b instanceof Scalar ? b.value : b;

        const levelA = Scalar.getLevel(va);
        const levelB = Scalar.getLevel(vb);

        let na = va;
        let nb = vb;
        for(let targetLevel = Math.max(levelA, levelB);targetLevel&lt;=3;targetLevel++){
            na = Scalar.promote(na, targetLevel);
            nb = Scalar.promote(nb, targetLevel);
            let v = na[opName](nb);
            if(v!==undefined){
                return new Scalar(v);
            }
        }
        throw new Error(`${opName} failed for ${a.toString()}, ${b.toString()}`);
    }


    /** @param {Scalar|any} other @returns {Scalar} */
    add(other) { return Scalar._binaryOp(this, other, 'add'); }
    /** @param {Scalar|any} other @returns {Scalar} */
    sub(other) { return Scalar._binaryOp(this, other, 'sub'); }
    /** @param {Scalar|any} other @returns {Scalar} */
    mul(other) { return Scalar._binaryOp(this, other, 'mul'); }
    /** @param {Scalar|any} other @returns {Scalar} */
    div(other) { return Scalar._binaryOp(this, other, 'div'); }
    /** @param {Scalar|any} other @returns {Scalar} */
    pow(other) { return Scalar._binaryOp(this, other, 'pow'); }

    // Alias for operator styles
    /** @param {Scalar|any} b @returns {Scalar} */
    operatorAdd(b) { return this.add(b); }
    /** @param {Scalar|any} b @returns {Scalar} */
    operatorSub(b) { return this.sub(b); }
    /** @param {Scalar|any} b @returns {Scalar} */
    operatorMul(b) { return this.mul(b); }
    /** @param {Scalar|any} b @returns {Scalar} */
    operatorDiv(b) { return this.div(b); }
    /** @param {Scalar|any} b @returns {Scalar} */
    operatorPow(b) { return this.pow(b); }
    /** @returns {Scalar} */
    operatorNeg() { return this.neg(); }

    /** @returns {Scalar} */
    neg()  { return new Scalar(this.value.neg()); }
    /** @returns {boolean} */
    isZero() {return this.value.isZero();}
    /** @returns {boolean} */
    isAlmostZero(){return this.value.isAlmostZero();};
    /** @returns {Scalar} */
    abs()   { return new Scalar(this.value.abs()); }


    /**
     * Internal dispatcher for functions that might return undefined for BigFraction.
     * @private
     * @param {string} opName The name of the operation.
     * @returns {Scalar}
     */
    _unary(opName) {
        if (this.level === 0) {
            const res = this.value[opName]();
            if (res !== undefined) return new Scalar(res);
            
            // Result is irrational, promote to BigFloat and retry
            const promoted = this.value.toBigFloat();
            return new Scalar(promoted[opName]());
        }
        return new Scalar(this.value[opName]());
    }
    
    /** @returns {Scalar} */
    exp()   { return this._unary('exp'); }
    /** @returns {Scalar} */
    log()   { return this._unary('log'); }
    /** @returns {Scalar} */
    sin()   { return this._unary('sin'); }
    /** @returns {Scalar} */
    cos()   { return this._unary('cos'); }
    /** @returns {Scalar} */
    tan()   { return this._unary('tan'); }
    /** @returns {Scalar} */
    asin()  { return this._unary('asin'); }
    /** @returns {Scalar} */
    acos()  { return this._unary('acos'); }
    /** @returns {Scalar} */
    atan()  { return this._unary('atan'); }
    /** @returns {Scalar} */
    sinh()  { return this._unary('sinh'); }
    /** @returns {Scalar} */
    cosh()  { return this._unary('cosh'); }
    /** @returns {Scalar} */
    tanh()  { return this._unary('tanh'); }
    /** @returns {Scalar} */
    asinh() { return this._unary('asinh'); }
    /** @returns {Scalar} */
    acosh() { return this._unary('acosh'); }
    /** @returns {Scalar} */
    atanh() { return this._unary('atanh'); }
    /** @returns {Scalar} */
    sqrt()  { return this._unary('sqrt'); }

    // --- Comparison &amp; Utilities ---

    /**
     * Compares this scalar with another value.
     * @param {Scalar|any} other
     * @returns {number} -1 if this &lt; other, 0 if this === other, 1 if this > other.
     */
    cmp(other) {
        const vb = (other instanceof Scalar) ? other.value : other;
        const targetLevel = Math.max(this.level, Scalar.getLevel(vb));
        if (targetLevel === 2) throw new Error("Complex numbers are not ordered.");
        return Scalar.promote(this.value, targetLevel).cmp(Scalar.promote(vb, targetLevel));
    }

    /**
     * Checks for equality with another value.
     * @param {Scalar|any} other
     * @returns {boolean}
     */
    equals(other) {
        const vb = (other instanceof Scalar) ? other.value : other;
        const targetLevel = Math.max(this.level, Scalar.getLevel(vb));
        return Scalar.promote(this.value, targetLevel).equals(Scalar.promote(vb, targetLevel));
    }

    /**
     * Converts the scalar to a string.
     * @param {number} [radix=10]
     * @param {number} [precision=-1]
     * @param {boolean} [pretty=false] pretty print
     * @returns {string}
     */
    toString(radix = 10, precision = -1, pretty=false) {
        return this.value.toString(radix, precision, pretty);
    }

    /**
     * Parses string and determines correct type/level.
     * @param {string} str
     * @returns {Scalar}
     */
    static fromString(str) {
        const s = str.trim();
        // 1. Complex check
        if (s.includes('i')) {
            return new Scalar(Complex.fromString(s));
        }
        // 2. Fraction check
        if (s.includes('/')) {
            return new Scalar(BigFraction.fromString(s));
        }
        // 3. Float or Integer check
        if (s.includes('.') || s.toLowerCase().includes('e')) {
            let nv=parseFloat(s);
            if(Number.isInteger(nv)){
                return new Scalar(BigFraction.fromString(s));
            }
            return new Scalar(BigFloat.fromString(s));
        }
        // 4. Default to Fraction if it's a clean integer string
        try {
            return new Scalar(new BigFraction(s));
        } catch(e) {
            return new Scalar(bf(s));
        }
    }
}

/**
 * Factory function for creating Scalar instances.
 * @param {number|bigint|string|BigFraction|BigFloat|Complex|Scalar} s
 * @returns {Scalar}
 */
export function scalar(s){
    if(s instanceof Scalar){
        return s;
    }
    return new Scalar(s);
}</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> on Mon Feb 16 2026 13:49:12 GMT+0800 (中国标准时间) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
