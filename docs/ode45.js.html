<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>ode45.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BigFloat.html">BigFloat</a><ul class='methods'><li data-type='method'><a href="BigFloat.html#abs">abs</a></li><li data-type='method'><a href="BigFloat.html#acos">acos</a></li><li data-type='method'><a href="BigFloat.html#add">add</a></li><li data-type='method'><a href="BigFloat.html#and">and</a></li><li data-type='method'><a href="BigFloat.html#asin">asin</a></li><li data-type='method'><a href="BigFloat.html#atan">atan</a></li><li data-type='method'><a href="BigFloat.html#atan2">atan2</a></li><li data-type='method'><a href="BigFloat.html#calc">calc</a></li><li data-type='method'><a href="BigFloat.html#calc2">calc2</a></li><li data-type='method'><a href="BigFloat.html#callFunc">callFunc</a></li><li data-type='method'><a href="BigFloat.html#ceil">ceil</a></li><li data-type='method'><a href="BigFloat.html#checkoprand">checkoprand</a></li><li data-type='method'><a href="BigFloat.html#checkstatus">checkstatus</a></li><li data-type='method'><a href="BigFloat.html#clone">clone</a></li><li data-type='method'><a href="BigFloat.html#cmp">cmp</a></li><li data-type='method'><a href="BigFloat.html#copy">copy</a></li><li data-type='method'><a href="BigFloat.html#cos">cos</a></li><li data-type='method'><a href="BigFloat.html#dispose">dispose</a></li><li data-type='method'><a href="BigFloat.html#div">div</a></li><li data-type='method'><a href="BigFloat.html#equals">equals</a></li><li data-type='method'><a href="BigFloat.html#exp">exp</a></li><li data-type='method'><a href="BigFloat.html#f64">f64</a></li><li data-type='method'><a href="BigFloat.html#floor">floor</a></li><li data-type='method'><a href="BigFloat.html#fpround">fpround</a></li><li data-type='method'><a href="BigFloat.html#fromNumber">fromNumber</a></li><li data-type='method'><a href="BigFloat.html#getEpsilon">getEpsilon</a></li><li data-type='method'><a href="BigFloat.html#geth">geth</a></li><li data-type='method'><a href="BigFloat.html#isAlmostZero">isAlmostZero</a></li><li data-type='method'><a href="BigFloat.html#isExactZero">isExactZero</a></li><li data-type='method'><a href="BigFloat.html#isFinit">isFinit</a></li><li data-type='method'><a href="BigFloat.html#isInExact">isInExact</a></li><li data-type='method'><a href="BigFloat.html#isNaN">isNaN</a></li><li data-type='method'><a href="BigFloat.html#isZero">isZero</a></li><li data-type='method'><a href="BigFloat.html#log">log</a></li><li data-type='method'><a href="BigFloat.html#mod">mod</a></li><li data-type='method'><a href="BigFloat.html#mul">mul</a></li><li data-type='method'><a href="BigFloat.html#neg">neg</a></li><li data-type='method'><a href="BigFloat.html#operatorEqual">operatorEqual</a></li><li data-type='method'><a href="BigFloat.html#operatorGreater">operatorGreater</a></li><li data-type='method'><a href="BigFloat.html#operatorGreaterEqual">operatorGreaterEqual</a></li><li data-type='method'><a href="BigFloat.html#operatorLess">operatorLess</a></li><li data-type='method'><a href="BigFloat.html#operatorLessEqual">operatorLessEqual</a></li><li data-type='method'><a href="BigFloat.html#operatorNotEqual">operatorNotEqual</a></li><li data-type='method'><a href="BigFloat.html#or">or</a></li><li data-type='method'><a href="BigFloat.html#pow">pow</a></li><li data-type='method'><a href="BigFloat.html#rem">rem</a></li><li data-type='method'><a href="BigFloat.html#round">round</a></li><li data-type='method'><a href="BigFloat.html#setEPSILON">setEPSILON</a></li><li data-type='method'><a href="BigFloat.html#setLOG2">setLOG2</a></li><li data-type='method'><a href="BigFloat.html#setMAX_VALUE">setMAX_VALUE</a></li><li data-type='method'><a href="BigFloat.html#setMIN_VALUE">setMIN_VALUE</a></li><li data-type='method'><a href="BigFloat.html#setPI">setPI</a></li><li data-type='method'><a href="BigFloat.html#setabs">setabs</a></li><li data-type='method'><a href="BigFloat.html#setacos">setacos</a></li><li data-type='method'><a href="BigFloat.html#setadd">setadd</a></li><li data-type='method'><a href="BigFloat.html#setand">setand</a></li><li data-type='method'><a href="BigFloat.html#setasin">setasin</a></li><li data-type='method'><a href="BigFloat.html#setatan">setatan</a></li><li data-type='method'><a href="BigFloat.html#setatan2">setatan2</a></li><li data-type='method'><a href="BigFloat.html#setceil">setceil</a></li><li data-type='method'><a href="BigFloat.html#setcos">setcos</a></li><li data-type='method'><a href="BigFloat.html#setdiv">setdiv</a></li><li data-type='method'><a href="BigFloat.html#setexp">setexp</a></li><li data-type='method'><a href="BigFloat.html#setfloor">setfloor</a></li><li data-type='method'><a href="BigFloat.html#setfpround">setfpround</a></li><li data-type='method'><a href="BigFloat.html#setlog">setlog</a></li><li data-type='method'><a href="BigFloat.html#setmod">setmod</a></li><li data-type='method'><a href="BigFloat.html#setmul">setmul</a></li><li data-type='method'><a href="BigFloat.html#setneg">setneg</a></li><li data-type='method'><a href="BigFloat.html#setor">setor</a></li><li data-type='method'><a href="BigFloat.html#setpow">setpow</a></li><li data-type='method'><a href="BigFloat.html#setrem">setrem</a></li><li data-type='method'><a href="BigFloat.html#setround">setround</a></li><li data-type='method'><a href="BigFloat.html#setsign">setsign</a></li><li data-type='method'><a href="BigFloat.html#setsin">setsin</a></li><li data-type='method'><a href="BigFloat.html#setsqrt">setsqrt</a></li><li data-type='method'><a href="BigFloat.html#setsub">setsub</a></li><li data-type='method'><a href="BigFloat.html#settan">settan</a></li><li data-type='method'><a href="BigFloat.html#settrunc">settrunc</a></li><li data-type='method'><a href="BigFloat.html#setxor">setxor</a></li><li data-type='method'><a href="BigFloat.html#sign">sign</a></li><li data-type='method'><a href="BigFloat.html#sin">sin</a></li><li data-type='method'><a href="BigFloat.html#sqrt">sqrt</a></li><li data-type='method'><a href="BigFloat.html#sub">sub</a></li><li data-type='method'><a href="BigFloat.html#tan">tan</a></li><li data-type='method'><a href="BigFloat.html#toBigInt">toBigInt</a></li><li data-type='method'><a href="BigFloat.html#toComplex">toComplex</a></li><li data-type='method'><a href="BigFloat.html#toFixed">toFixed</a></li><li data-type='method'><a href="BigFloat.html#toNumber">toNumber</a></li><li data-type='method'><a href="BigFloat.html#toString">toString</a></li><li data-type='method'><a href="BigFloat.html#toUint8Array">toUint8Array</a></li><li data-type='method'><a href="BigFloat.html#trunc">trunc</a></li><li data-type='method'><a href="BigFloat.html#visit">visit</a></li><li data-type='method'><a href="BigFloat.html#wraptypeh">wraptypeh</a></li><li data-type='method'><a href="BigFloat.html#xor">xor</a></li><li data-type='method'><a href="BigFloat.html#.fromString">fromString</a></li></ul></li><li><a href="BigFloat_BigFloat.html">BigFloat</a></li><li><a href="BigFraction.html">BigFraction</a><ul class='methods'><li data-type='method'><a href="BigFraction.html#abs">abs</a></li><li data-type='method'><a href="BigFraction.html#acos">acos</a></li><li data-type='method'><a href="BigFraction.html#acosh">acosh</a></li><li data-type='method'><a href="BigFraction.html#add">add</a></li><li data-type='method'><a href="BigFraction.html#asin">asin</a></li><li data-type='method'><a href="BigFraction.html#asinh">asinh</a></li><li data-type='method'><a href="BigFraction.html#atan">atan</a></li><li data-type='method'><a href="BigFraction.html#atanh">atanh</a></li><li data-type='method'><a href="BigFraction.html#cmp">cmp</a></li><li data-type='method'><a href="BigFraction.html#cos">cos</a></li><li data-type='method'><a href="BigFraction.html#cosh">cosh</a></li><li data-type='method'><a href="BigFraction.html#div">div</a></li><li data-type='method'><a href="BigFraction.html#equals">equals</a></li><li data-type='method'><a href="BigFraction.html#exp">exp</a></li><li data-type='method'><a href="BigFraction.html#floor">floor</a></li><li data-type='method'><a href="BigFraction.html#isAlmostZero">isAlmostZero</a></li><li data-type='method'><a href="BigFraction.html#isNaN">isNaN</a></li><li data-type='method'><a href="BigFraction.html#isZero">isZero</a></li><li data-type='method'><a href="BigFraction.html#log">log</a></li><li data-type='method'><a href="BigFraction.html#mul">mul</a></li><li data-type='method'><a href="BigFraction.html#neg">neg</a></li><li data-type='method'><a href="BigFraction.html#operatorAdd">operatorAdd</a></li><li data-type='method'><a href="BigFraction.html#operatorDiv">operatorDiv</a></li><li data-type='method'><a href="BigFraction.html#operatorEqual">operatorEqual</a></li><li data-type='method'><a href="BigFraction.html#operatorGreater">operatorGreater</a></li><li data-type='method'><a href="BigFraction.html#operatorGreaterEqual">operatorGreaterEqual</a></li><li data-type='method'><a href="BigFraction.html#operatorLess">operatorLess</a></li><li data-type='method'><a href="BigFraction.html#operatorLessEqual">operatorLessEqual</a></li><li data-type='method'><a href="BigFraction.html#operatorMul">operatorMul</a></li><li data-type='method'><a href="BigFraction.html#operatorNeg">operatorNeg</a></li><li data-type='method'><a href="BigFraction.html#operatorNotEqual">operatorNotEqual</a></li><li data-type='method'><a href="BigFraction.html#operatorPow">operatorPow</a></li><li data-type='method'><a href="BigFraction.html#operatorSub">operatorSub</a></li><li data-type='method'><a href="BigFraction.html#pow">pow</a></li><li data-type='method'><a href="BigFraction.html#sin">sin</a></li><li data-type='method'><a href="BigFraction.html#sinh">sinh</a></li><li data-type='method'><a href="BigFraction.html#sqrt">sqrt</a></li><li data-type='method'><a href="BigFraction.html#sub">sub</a></li><li data-type='method'><a href="BigFraction.html#tan">tan</a></li><li data-type='method'><a href="BigFraction.html#tanh">tanh</a></li><li data-type='method'><a href="BigFraction.html#toBigFloat">toBigFloat</a></li><li data-type='method'><a href="BigFraction.html#toNumber">toNumber</a></li><li data-type='method'><a href="BigFraction.html#toString">toString</a></li><li data-type='method'><a href="BigFraction.html#.fromString">fromString</a></li></ul></li><li><a href="BigFraction_BigFraction.html">BigFraction</a></li><li><a href="Complex.html">Complex</a><ul class='methods'><li data-type='method'><a href="Complex.html#abs">abs</a></li><li data-type='method'><a href="Complex.html#acos">acos</a></li><li data-type='method'><a href="Complex.html#acosh">acosh</a></li><li data-type='method'><a href="Complex.html#add">add</a></li><li data-type='method'><a href="Complex.html#arg">arg</a></li><li data-type='method'><a href="Complex.html#asin">asin</a></li><li data-type='method'><a href="Complex.html#asinh">asinh</a></li><li data-type='method'><a href="Complex.html#atan">atan</a></li><li data-type='method'><a href="Complex.html#atanh">atanh</a></li><li data-type='method'><a href="Complex.html#conj">conj</a></li><li data-type='method'><a href="Complex.html#cos">cos</a></li><li data-type='method'><a href="Complex.html#cosh">cosh</a></li><li data-type='method'><a href="Complex.html#div">div</a></li><li data-type='method'><a href="Complex.html#equals">equals</a></li><li data-type='method'><a href="Complex.html#exp">exp</a></li><li data-type='method'><a href="Complex.html#isAlmostZero">isAlmostZero</a></li><li data-type='method'><a href="Complex.html#isZero">isZero</a></li><li data-type='method'><a href="Complex.html#log">log</a></li><li data-type='method'><a href="Complex.html#mul">mul</a></li><li data-type='method'><a href="Complex.html#neg">neg</a></li><li data-type='method'><a href="Complex.html#pow">pow</a></li><li data-type='method'><a href="Complex.html#sin">sin</a></li><li data-type='method'><a href="Complex.html#sinh">sinh</a></li><li data-type='method'><a href="Complex.html#sqrt">sqrt</a></li><li data-type='method'><a href="Complex.html#sub">sub</a></li><li data-type='method'><a href="Complex.html#tan">tan</a></li><li data-type='method'><a href="Complex.html#tanh">tanh</a></li><li data-type='method'><a href="Complex.html#toString">toString</a></li><li data-type='method'><a href="Complex.html#.fromPolar">fromPolar</a></li><li data-type='method'><a href="Complex.html#.fromString">fromString</a></li></ul></li><li><a href="Poly.html">Poly</a><ul class='methods'><li data-type='method'><a href="Poly.html#acos">acos</a></li><li data-type='method'><a href="Poly.html#add">add</a></li><li data-type='method'><a href="Poly.html#asin">asin</a></li><li data-type='method'><a href="Poly.html#atan">atan</a></li><li data-type='method'><a href="Poly.html#cos">cos</a></li><li data-type='method'><a href="Poly.html#degree">degree</a></li><li data-type='method'><a href="Poly.html#deriv">deriv</a></li><li data-type='method'><a href="Poly.html#div">div</a></li><li data-type='method'><a href="Poly.html#equals">equals</a></li><li data-type='method'><a href="Poly.html#eval">eval</a></li><li data-type='method'><a href="Poly.html#exp">exp</a></li><li data-type='method'><a href="Poly.html#integ">integ</a></li><li data-type='method'><a href="Poly.html#log">log</a></li><li data-type='method'><a href="Poly.html#mul">mul</a></li><li data-type='method'><a href="Poly.html#neg">neg</a></li><li data-type='method'><a href="Poly.html#operatorAdd">operatorAdd</a></li><li data-type='method'><a href="Poly.html#operatorDiv">operatorDiv</a></li><li data-type='method'><a href="Poly.html#operatorMul">operatorMul</a></li><li data-type='method'><a href="Poly.html#operatorNeg">operatorNeg</a></li><li data-type='method'><a href="Poly.html#operatorPow">operatorPow</a></li><li data-type='method'><a href="Poly.html#operatorSub">operatorSub</a></li><li data-type='method'><a href="Poly.html#pow">pow</a></li><li data-type='method'><a href="Poly.html#powSeries">powSeries</a></li><li data-type='method'><a href="Poly.html#sin">sin</a></li><li data-type='method'><a href="Poly.html#sub">sub</a></li><li data-type='method'><a href="Poly.html#tan">tan</a></li><li data-type='method'><a href="Poly.html#toString">toString</a></li><li data-type='method'><a href="Poly.html#valuation">valuation</a></li><li data-type='method'><a href="Poly.html#.O">O</a></li><li data-type='method'><a href="Poly.html#.X">X</a></li></ul></li><li><a href="Scalar.html">Scalar</a><ul class='methods'><li data-type='method'><a href="Scalar.html#abs">abs</a></li><li data-type='method'><a href="Scalar.html#acos">acos</a></li><li data-type='method'><a href="Scalar.html#acosh">acosh</a></li><li data-type='method'><a href="Scalar.html#add">add</a></li><li data-type='method'><a href="Scalar.html#asin">asin</a></li><li data-type='method'><a href="Scalar.html#asinh">asinh</a></li><li data-type='method'><a href="Scalar.html#atan">atan</a></li><li data-type='method'><a href="Scalar.html#atanh">atanh</a></li><li data-type='method'><a href="Scalar.html#cmp">cmp</a></li><li data-type='method'><a href="Scalar.html#cos">cos</a></li><li data-type='method'><a href="Scalar.html#cosh">cosh</a></li><li data-type='method'><a href="Scalar.html#div">div</a></li><li data-type='method'><a href="Scalar.html#equals">equals</a></li><li data-type='method'><a href="Scalar.html#exp">exp</a></li><li data-type='method'><a href="Scalar.html#isAlmostZero">isAlmostZero</a></li><li data-type='method'><a href="Scalar.html#isZero">isZero</a></li><li data-type='method'><a href="Scalar.html#log">log</a></li><li data-type='method'><a href="Scalar.html#mul">mul</a></li><li data-type='method'><a href="Scalar.html#neg">neg</a></li><li data-type='method'><a href="Scalar.html#operatorAdd">operatorAdd</a></li><li data-type='method'><a href="Scalar.html#operatorDiv">operatorDiv</a></li><li data-type='method'><a href="Scalar.html#operatorMul">operatorMul</a></li><li data-type='method'><a href="Scalar.html#operatorNeg">operatorNeg</a></li><li data-type='method'><a href="Scalar.html#operatorPow">operatorPow</a></li><li data-type='method'><a href="Scalar.html#operatorSub">operatorSub</a></li><li data-type='method'><a href="Scalar.html#pow">pow</a></li><li data-type='method'><a href="Scalar.html#sin">sin</a></li><li data-type='method'><a href="Scalar.html#sinh">sinh</a></li><li data-type='method'><a href="Scalar.html#sqrt">sqrt</a></li><li data-type='method'><a href="Scalar.html#sub">sub</a></li><li data-type='method'><a href="Scalar.html#tan">tan</a></li><li data-type='method'><a href="Scalar.html#tanh">tanh</a></li><li data-type='method'><a href="Scalar.html#toString">toString</a></li><li data-type='method'><a href="Scalar.html#.fromString">fromString</a></li><li data-type='method'><a href="Scalar.html#.getLevel">getLevel</a></li><li data-type='method'><a href="Scalar.html#.promote">promote</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#E">E</a></li><li><a href="global.html#Flags">Flags</a></li><li><a href="global.html#O">O</a></li><li><a href="global.html#PI">PI</a></li><li><a href="global.html#X">X</a></li><li><a href="global.html#abs">abs</a></li><li><a href="global.html#acos">acos</a></li><li><a href="global.html#asin">asin</a></li><li><a href="global.html#atan">atan</a></li><li><a href="global.html#atan2">atan2</a></li><li><a href="global.html#bf">bf</a></li><li><a href="global.html#bigIntSqrt">bigIntSqrt</a></li><li><a href="global.html#ceil">ceil</a></li><li><a href="global.html#complex">complex</a></li><li><a href="global.html#cos">cos</a></li><li><a href="global.html#decimal_precision">decimal_precision</a></li><li><a href="global.html#exp">exp</a></li><li><a href="global.html#floor">floor</a></li><li><a href="global.html#fminbnd">fminbnd</a></li><li><a href="global.html#formatDecimal">formatDecimal</a></li><li><a href="global.html#fpround">fpround</a></li><li><a href="global.html#frac">frac</a></li><li><a href="global.html#fromDouble">fromDouble</a></li><li><a href="global.html#fzero">fzero</a></li><li><a href="global.html#gc_ele_limit">gc_ele_limit</a></li><li><a href="global.html#gcd">gcd</a></li><li><a href="global.html#globalFlag">globalFlag</a></li><li><a href="global.html#half">half</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#is_ready">is_ready</a></li><li><a href="global.html#libbf">libbf</a></li><li><a href="global.html#log">log</a></li><li><a href="global.html#max">max</a></li><li><a href="global.html#minus_one">minus_one</a></li><li><a href="global.html#neg">neg</a></li><li><a href="global.html#ode45">ode45</a></li><li><a href="global.html#one">one</a></li><li><a href="global.html#poly">poly</a></li><li><a href="global.html#polyStr">polyStr</a></li><li><a href="global.html#polyfit">polyfit</a></li><li><a href="global.html#polyval">polyval</a></li><li><a href="global.html#pop_precision">pop_precision</a></li><li><a href="global.html#pow">pow</a></li><li><a href="global.html#precision">precision</a></li><li><a href="global.html#push_decimal_precision">push_decimal_precision</a></li><li><a href="global.html#push_precision">push_precision</a></li><li><a href="global.html#romberg">romberg</a></li><li><a href="global.html#roots">roots</a></li><li><a href="global.html#round">round</a></li><li><a href="global.html#scalar">scalar</a></li><li><a href="global.html#setGlobalFlag">setGlobalFlag</a></li><li><a href="global.html#setPrecision">setPrecision</a></li><li><a href="global.html#setThrowExceptionOnInvalidOp">setThrowExceptionOnInvalidOp</a></li><li><a href="global.html#set_gc_ele_limit">set_gc_ele_limit</a></li><li><a href="global.html#sign">sign</a></li><li><a href="global.html#sin">sin</a></li><li><a href="global.html#solveLinearSystem">solveLinearSystem</a></li><li><a href="global.html#sqrt">sqrt</a></li><li><a href="global.html#tan">tan</a></li><li><a href="global.html#three">three</a></li><li><a href="global.html#throwExceptionOnInvalidOp">throwExceptionOnInvalidOp</a></li><li><a href="global.html#trunc">trunc</a></li><li><a href="global.html#two">two</a></li><li><a href="global.html#zero">zero</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">ode45.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * High-precision ODE Solver using Dormand-Prince method (similar to MATLAB's ode45).
 * 
 * Solves non-stiff differential equations y' = f(t, y).
 * Implementation of the explicit Runge-Kutta (4,5) formula (Dormand-Prince pair).
 * Supports adaptive step size control.
 *
 * @param {Function} odefun - The main function to integrate: dydt = odefun(t, y).
 *        - t: BigFloat (current time)
 *        - y: Array&lt;BigFloat> (current state vector)
 *        Returns: Array&lt;BigFloat> (derivatives)
 *
 * @param {Array&lt;number|string|BigFloat>} tspan - Interval of integration [t0, tf].
 *
 * @param {Array&lt;number|string|BigFloat>|BigFloat} y0 - Initial conditions.
 *        Can be a scalar (converted to array internally) or an array of values.
 *
 * @param {Object} [info={}] - Configuration and Status object.
 *        Updates in-place with solution data and statistics.
 *
 *        // --- Input Configuration Properties ---
 * @param {number|string|BigFloat} [info._e=1e-16] - Absolute Tolerence (AbsTol).
 * @param {number|string|BigFloat} [info._re=1e-16] - Relative Tolerance (RelTol).
 *        Error control: |e| &lt;= max(RelTol * |y|, AbsTol)
 * @param {number|string|BigFloat} [info.initial_step] - Initial step size guess. 
 *        If omitted, it is automatically estimated.
 * @param {number} [info.max_step=10000] - Maximum number of steps allowed.
 * @param {number} [info.max_time=60000] - Maximum execution time in milliseconds.
 * @param {Function} [info.cb] - Optional callback per step: cb(t, y).
 *
 *        // --- Output Status Properties ---
 * @param {Array&lt;BigFloat>} info.t - Array of time points.
 * @param {Array&lt;Array&lt;BigFloat>>} info.y - Array of state vectors corresponding to info.t.
 * @param {number} info.steps - Total successful steps taken.
 * @param {number} info.failed_steps - Number of rejected steps (due to error tolerance).
 * @param {number} info.exectime - Execution time in ms.
 * @param {string} info.status - "done", "timeout", or "max_steps".
 * 
 * @returns {Object|null} 
 *        Returns { t, y } (references to info.t and info.y) if successful.
 *        Returns null if critical errors occur.
 */
export function ode45(odefun, tspan, y0, info = {}) {
    // 1. Configuration &amp; Constants
    
    // Default Tolerance: 
    // MATLAB default is 1e-3 Rel, 1e-6 Abs. 
    // Since we are in BigFloat context and tests expect ~15 digits, we default to 1e-16.
    let _e  = bfjs.bf(info._e ?? 1e-16);
    let _re = bfjs.bf(info._re ?? 1e-16);
    
    let max_steps_limit = info.max_step || 100000; // Increased limit for high precision
    let max_time = info.max_time || 60000;

    const start_time = new Date().getTime();

    // Cache BigFloat constants
    const bf = (n) => bfjs.bf(n);
    const bf_zero = bfjs.zero;
    const bf_one = bfjs.one;
    const bf_p1 = bf(0.1); 
    const bf_p8 = bf(0.8);
    const bf_p9 = bf(0.9);
    const bf_5 = bf(5);

    // Rational helper
    const rat = (n, d) => bf(n).div(bf(d));

    // --- Dormand-Prince 5(4) Coefficients ---
    const c2 = rat(1, 5), c3 = rat(3, 10), c4 = rat(4, 5), c5 = rat(8, 9);
    // c6 = 1, c7 = 1
    
    const a21 = rat(1, 5);
    const a31 = rat(3, 40),       a32 = rat(9, 40);
    const a41 = rat(44, 45),      a42 = rat(-56, 15),      a43 = rat(32, 9);
    const a51 = rat(19372, 6561), a52 = rat(-25360, 2187), a53 = rat(64448, 6561), a54 = rat(-212, 729);
    const a61 = rat(9017, 3168),  a62 = rat(-355, 33),     a63 = rat(46732, 5247), a64 = rat(49, 176),   a65 = rat(-5103, 18656);
    const a71 = rat(35, 384),     a72 = bf_zero,           a73 = rat(500, 1113),   a74 = rat(125, 192),  a75 = rat(-2187, 6784),  a76 = rat(11, 84);

    const b1 = a71, b3 = a73, b4 = a74, b5 = a75, b6 = a76;

    const E1 = rat(71, 57600);
    const E3 = rat(-71, 16695);
    const E4 = rat(71, 1920);
    const E5 = rat(-17253, 339200);
    const E6 = rat(22, 525);
    const E7 = rat(-1, 40);

    // --- Helpers ---
    let y_curr = Array.isArray(y0) ? y0.map(bf) : [bf(y0)];
    let dim = y_curr.length;

    const computeStageY = (y, h, coeffs, k_vecs) => {
        let res = new Array(dim);
        for(let i=0; i&lt;dim; i++) {
            let sum = bf_zero;
            for(let j=0; j&lt;coeffs.length; j++) {
                if (coeffs[j].isZero()) continue;
                sum = sum.add(k_vecs[j][i].mul(coeffs[j]));
            }
            res[i] = y[i].add(sum.mul(h));
        }
        return res;
    };

    // 2. Initialization
    let t_start = bf(tspan[0]);
    let t_final = bf(tspan[1]);
    let t = t_start;
    
    // Check for zero span
    if (t_start.cmp(t_final) === 0) {
        return null;
    }

    let h = info.initial_step ? bf(info.initial_step) : bf_zero;
    
    let absTol = _e;
    let relTol = _re;

    let direction = t_final.sub(t_start).sign(); 
    
    // Automatic initial step size guess
    if (h.isZero()) {
        h = t_final.sub(t_start).mul(rat(1, 100)).abs();
        // Constrain initial guess to avoid being too small or too large
        let min_h = rat(1, 1000000);
        if (h.cmp(min_h) &lt; 0) h = min_h;
        // Don't exceed full span
        if (h.cmp(t_final.sub(t_start).abs()) > 0) h = t_final.sub(t_start).abs();
    }
    // Apply direction
    h = h.abs().mul(bf(direction));

    info.t = [t];
    info.y = [y_curr.map(val => val)];
    info.steps = 0;
    info.failed_steps = 0;
    info.status = "running";

    let k1 = odefun(t, y_curr);
    if (!Array.isArray(k1)) k1 = [k1];

    // 3. Main Loop
    let done = false;
    let steps = 0;

    while (!done) {
        if (steps >= max_steps_limit) {
            console.warn(`ode45: Max steps (${max_steps_limit}) exceeded at t=${t.toString(10, 6)}.`);
            info.status = "max_steps";
            break;
        }
        if (new Date().getTime() - start_time > max_time) {
            console.warn("ode45: Timeout reached.");
            info.status = "timeout";
            break;
        }

        // Distance to end
        let dist_to_end = t_final.sub(t);
        let dist_abs = dist_to_end.abs();
        let h_abs = h.abs();

        // Check if we are close enough to finish
        if (dist_abs.cmp(bf(1e-40)) &lt;= 0) { // Safety epsilon
            done = true;
            break;
        }

        // Clamp step size to hit t_final exactly
        // Use a flag 'last_step' to know if we are forcing the step
        let last_step = false;
        if (h_abs.cmp(dist_abs) >= 0) {
            h = dist_to_end;
            last_step = true;
        }

        // --- Stages ---
        let y_temp = computeStageY(y_curr, h, [a21], [k1]);
        let k2 = odefun(t.add(c2.mul(h)), y_temp);
        if (!Array.isArray(k2)) k2 = [k2];

        y_temp = computeStageY(y_curr, h, [a31, a32], [k1, k2]);
        let k3 = odefun(t.add(c3.mul(h)), y_temp);
        if (!Array.isArray(k3)) k3 = [k3];

        y_temp = computeStageY(y_curr, h, [a41, a42, a43], [k1, k2, k3]);
        let k4 = odefun(t.add(c4.mul(h)), y_temp);
        if (!Array.isArray(k4)) k4 = [k4];

        y_temp = computeStageY(y_curr, h, [a51, a52, a53, a54], [k1, k2, k3, k4]);
        let k5 = odefun(t.add(c5.mul(h)), y_temp);
        if (!Array.isArray(k5)) k5 = [k5];

        y_temp = computeStageY(y_curr, h, [a61, a62, a63, a64, a65], [k1, k2, k3, k4, k5]);
        let k6 = odefun(t.add(h), y_temp); // c6=1
        if (!Array.isArray(k6)) k6 = [k6];

        // Result Candidate
        let y_next = computeStageY(y_curr, h, [b1, bf_zero, b3, b4, b5, b6], [k1, k2, k3, k4, k5, k6]);
        
        let k7 = odefun(t.add(h), y_next);
        if (!Array.isArray(k7)) k7 = [k7];

        // Error Calculation
        let max_norm_err = bf_zero;
        for(let i=0; i&lt;dim; i++) {
            let term = k1[i].mul(E1)
                .add(k3[i].mul(E3))
                .add(k4[i].mul(E4))
                .add(k5[i].mul(E5))
                .add(k6[i].mul(E6))
                .add(k7[i].mul(E7));
            
            let err_abs_val = term.mul(h).abs();
            let y_max = y_curr[i].abs().cmp(y_next[i].abs()) > 0 ? y_curr[i].abs() : y_next[i].abs();
            let sc = absTol.add(y_max.mul(relTol));
            
            let ratio = err_abs_val.div(sc);
            if (ratio.cmp(max_norm_err) > 0) {
                max_norm_err = ratio;
            }
        }

        // --- Accept/Reject ---
        if (max_norm_err.cmp(bf_one) &lt;= 0) {
            // ACCEPT
            t = t.add(h);
            y_curr = y_next;
            k1 = k7; // FSAL
            steps++;

            info.t.push(t);
            info.y.push(y_curr.map(v => v));
            if (info.cb) info.cb(t, y_curr);

            if (last_step) {
                done = true;
            } else {
                // Grow step
                let factor = bf_zero;
                if (max_norm_err.cmp(bf(1e-40)) &lt; 0) {
                    factor = bf_5; 
                } else {
                    let inv_err = bf_one.div(max_norm_err);
                    // factor = 0.9 * err^(-0.2)
                    let pow_val = bfjs.exp(inv_err.log().mul(bf(0.2))); 
                    factor = bf_p9.mul(pow_val);
                }
                if (factor.cmp(bf_5) > 0) factor = bf_5;
                if (factor.cmp(bf_p1) &lt; 0) factor = bf_p1;
                
                h = h.mul(factor);
            }
        } else {
            // REJECT
            info.failed_steps++;
            // If we tried to force the last step but it failed, we are not done.
            // We need to shrink and try again.
            
            // Shrink step
            let inv_err = bf_one.div(max_norm_err);
            let pow_val = bfjs.exp(inv_err.log().mul(bf(0.2))); 
            let factor = bf_p9.mul(pow_val);
            
            if (factor.cmp(bf_p1) &lt; 0) factor = bf_p1;
            if (factor.cmp(bf_p8) > 0) factor = bf_p8;

            h = h.mul(factor);

            // Underflow check
            if (h.abs().cmp(bf(1e-50)) &lt; 0) {
                console.warn("ode45: Step size underflow.");
                info.status = "underflow";
                break;
            }
        }
    }

    if (info.status === "running") info.status = "done";
    
    info.exectime = new Date().getTime() - start_time;
    info.steps = steps;
    
    info.toString = function() {
        return `status=${this.status}, steps=${this.steps}, failed=${this.failed_steps}, t_final=${this.t[this.t.length-1].toString(10, 6)}`;
    };

    return { t: info.t, y: info.y };
}</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> on Mon Feb 16 2026 13:49:12 GMT+0800 (中国标准时间) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
