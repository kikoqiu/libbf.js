<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>frac.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BigFloat.html">BigFloat</a><ul class='methods'><li data-type='method'><a href="BigFloat.html#abs">abs</a></li><li data-type='method'><a href="BigFloat.html#acos">acos</a></li><li data-type='method'><a href="BigFloat.html#add">add</a></li><li data-type='method'><a href="BigFloat.html#and">and</a></li><li data-type='method'><a href="BigFloat.html#asin">asin</a></li><li data-type='method'><a href="BigFloat.html#atan">atan</a></li><li data-type='method'><a href="BigFloat.html#atan2">atan2</a></li><li data-type='method'><a href="BigFloat.html#calc">calc</a></li><li data-type='method'><a href="BigFloat.html#calc2">calc2</a></li><li data-type='method'><a href="BigFloat.html#callFunc">callFunc</a></li><li data-type='method'><a href="BigFloat.html#ceil">ceil</a></li><li data-type='method'><a href="BigFloat.html#checkoprand">checkoprand</a></li><li data-type='method'><a href="BigFloat.html#checkstatus">checkstatus</a></li><li data-type='method'><a href="BigFloat.html#clone">clone</a></li><li data-type='method'><a href="BigFloat.html#cmp">cmp</a></li><li data-type='method'><a href="BigFloat.html#copy">copy</a></li><li data-type='method'><a href="BigFloat.html#cos">cos</a></li><li data-type='method'><a href="BigFloat.html#dispose">dispose</a></li><li data-type='method'><a href="BigFloat.html#div">div</a></li><li data-type='method'><a href="BigFloat.html#equals">equals</a></li><li data-type='method'><a href="BigFloat.html#exp">exp</a></li><li data-type='method'><a href="BigFloat.html#f64">f64</a></li><li data-type='method'><a href="BigFloat.html#floor">floor</a></li><li data-type='method'><a href="BigFloat.html#fpround">fpround</a></li><li data-type='method'><a href="BigFloat.html#fromNumber">fromNumber</a></li><li data-type='method'><a href="BigFloat.html#getEpsilon">getEpsilon</a></li><li data-type='method'><a href="BigFloat.html#geth">geth</a></li><li data-type='method'><a href="BigFloat.html#isAlmostZero">isAlmostZero</a></li><li data-type='method'><a href="BigFloat.html#isExactZero">isExactZero</a></li><li data-type='method'><a href="BigFloat.html#isFinit">isFinit</a></li><li data-type='method'><a href="BigFloat.html#isInExact">isInExact</a></li><li data-type='method'><a href="BigFloat.html#isNaN">isNaN</a></li><li data-type='method'><a href="BigFloat.html#isZero">isZero</a></li><li data-type='method'><a href="BigFloat.html#log">log</a></li><li data-type='method'><a href="BigFloat.html#mod">mod</a></li><li data-type='method'><a href="BigFloat.html#mul">mul</a></li><li data-type='method'><a href="BigFloat.html#neg">neg</a></li><li data-type='method'><a href="BigFloat.html#operatorEqual">operatorEqual</a></li><li data-type='method'><a href="BigFloat.html#operatorGreater">operatorGreater</a></li><li data-type='method'><a href="BigFloat.html#operatorGreaterEqual">operatorGreaterEqual</a></li><li data-type='method'><a href="BigFloat.html#operatorLess">operatorLess</a></li><li data-type='method'><a href="BigFloat.html#operatorLessEqual">operatorLessEqual</a></li><li data-type='method'><a href="BigFloat.html#operatorNotEqual">operatorNotEqual</a></li><li data-type='method'><a href="BigFloat.html#or">or</a></li><li data-type='method'><a href="BigFloat.html#pow">pow</a></li><li data-type='method'><a href="BigFloat.html#rem">rem</a></li><li data-type='method'><a href="BigFloat.html#round">round</a></li><li data-type='method'><a href="BigFloat.html#setEPSILON">setEPSILON</a></li><li data-type='method'><a href="BigFloat.html#setLOG2">setLOG2</a></li><li data-type='method'><a href="BigFloat.html#setMAX_VALUE">setMAX_VALUE</a></li><li data-type='method'><a href="BigFloat.html#setMIN_VALUE">setMIN_VALUE</a></li><li data-type='method'><a href="BigFloat.html#setPI">setPI</a></li><li data-type='method'><a href="BigFloat.html#setabs">setabs</a></li><li data-type='method'><a href="BigFloat.html#setacos">setacos</a></li><li data-type='method'><a href="BigFloat.html#setadd">setadd</a></li><li data-type='method'><a href="BigFloat.html#setand">setand</a></li><li data-type='method'><a href="BigFloat.html#setasin">setasin</a></li><li data-type='method'><a href="BigFloat.html#setatan">setatan</a></li><li data-type='method'><a href="BigFloat.html#setatan2">setatan2</a></li><li data-type='method'><a href="BigFloat.html#setceil">setceil</a></li><li data-type='method'><a href="BigFloat.html#setcos">setcos</a></li><li data-type='method'><a href="BigFloat.html#setdiv">setdiv</a></li><li data-type='method'><a href="BigFloat.html#setexp">setexp</a></li><li data-type='method'><a href="BigFloat.html#setfloor">setfloor</a></li><li data-type='method'><a href="BigFloat.html#setfpround">setfpround</a></li><li data-type='method'><a href="BigFloat.html#setlog">setlog</a></li><li data-type='method'><a href="BigFloat.html#setmod">setmod</a></li><li data-type='method'><a href="BigFloat.html#setmul">setmul</a></li><li data-type='method'><a href="BigFloat.html#setneg">setneg</a></li><li data-type='method'><a href="BigFloat.html#setor">setor</a></li><li data-type='method'><a href="BigFloat.html#setpow">setpow</a></li><li data-type='method'><a href="BigFloat.html#setrem">setrem</a></li><li data-type='method'><a href="BigFloat.html#setround">setround</a></li><li data-type='method'><a href="BigFloat.html#setsign">setsign</a></li><li data-type='method'><a href="BigFloat.html#setsin">setsin</a></li><li data-type='method'><a href="BigFloat.html#setsqrt">setsqrt</a></li><li data-type='method'><a href="BigFloat.html#setsub">setsub</a></li><li data-type='method'><a href="BigFloat.html#settan">settan</a></li><li data-type='method'><a href="BigFloat.html#settrunc">settrunc</a></li><li data-type='method'><a href="BigFloat.html#setxor">setxor</a></li><li data-type='method'><a href="BigFloat.html#sign">sign</a></li><li data-type='method'><a href="BigFloat.html#sin">sin</a></li><li data-type='method'><a href="BigFloat.html#sqrt">sqrt</a></li><li data-type='method'><a href="BigFloat.html#sub">sub</a></li><li data-type='method'><a href="BigFloat.html#tan">tan</a></li><li data-type='method'><a href="BigFloat.html#toBigInt">toBigInt</a></li><li data-type='method'><a href="BigFloat.html#toComplex">toComplex</a></li><li data-type='method'><a href="BigFloat.html#toFixed">toFixed</a></li><li data-type='method'><a href="BigFloat.html#toNumber">toNumber</a></li><li data-type='method'><a href="BigFloat.html#toString">toString</a></li><li data-type='method'><a href="BigFloat.html#toUint8Array">toUint8Array</a></li><li data-type='method'><a href="BigFloat.html#trunc">trunc</a></li><li data-type='method'><a href="BigFloat.html#visit">visit</a></li><li data-type='method'><a href="BigFloat.html#wraptypeh">wraptypeh</a></li><li data-type='method'><a href="BigFloat.html#xor">xor</a></li><li data-type='method'><a href="BigFloat.html#.fromString">fromString</a></li></ul></li><li><a href="BigFloat_BigFloat.html">BigFloat</a></li><li><a href="BigFraction.html">BigFraction</a><ul class='methods'><li data-type='method'><a href="BigFraction.html#abs">abs</a></li><li data-type='method'><a href="BigFraction.html#acos">acos</a></li><li data-type='method'><a href="BigFraction.html#acosh">acosh</a></li><li data-type='method'><a href="BigFraction.html#add">add</a></li><li data-type='method'><a href="BigFraction.html#asin">asin</a></li><li data-type='method'><a href="BigFraction.html#asinh">asinh</a></li><li data-type='method'><a href="BigFraction.html#atan">atan</a></li><li data-type='method'><a href="BigFraction.html#atanh">atanh</a></li><li data-type='method'><a href="BigFraction.html#cmp">cmp</a></li><li data-type='method'><a href="BigFraction.html#cos">cos</a></li><li data-type='method'><a href="BigFraction.html#cosh">cosh</a></li><li data-type='method'><a href="BigFraction.html#div">div</a></li><li data-type='method'><a href="BigFraction.html#equals">equals</a></li><li data-type='method'><a href="BigFraction.html#exp">exp</a></li><li data-type='method'><a href="BigFraction.html#floor">floor</a></li><li data-type='method'><a href="BigFraction.html#isAlmostZero">isAlmostZero</a></li><li data-type='method'><a href="BigFraction.html#isNaN">isNaN</a></li><li data-type='method'><a href="BigFraction.html#isZero">isZero</a></li><li data-type='method'><a href="BigFraction.html#log">log</a></li><li data-type='method'><a href="BigFraction.html#mul">mul</a></li><li data-type='method'><a href="BigFraction.html#neg">neg</a></li><li data-type='method'><a href="BigFraction.html#operatorAdd">operatorAdd</a></li><li data-type='method'><a href="BigFraction.html#operatorDiv">operatorDiv</a></li><li data-type='method'><a href="BigFraction.html#operatorEqual">operatorEqual</a></li><li data-type='method'><a href="BigFraction.html#operatorGreater">operatorGreater</a></li><li data-type='method'><a href="BigFraction.html#operatorGreaterEqual">operatorGreaterEqual</a></li><li data-type='method'><a href="BigFraction.html#operatorLess">operatorLess</a></li><li data-type='method'><a href="BigFraction.html#operatorLessEqual">operatorLessEqual</a></li><li data-type='method'><a href="BigFraction.html#operatorMul">operatorMul</a></li><li data-type='method'><a href="BigFraction.html#operatorNeg">operatorNeg</a></li><li data-type='method'><a href="BigFraction.html#operatorNotEqual">operatorNotEqual</a></li><li data-type='method'><a href="BigFraction.html#operatorPow">operatorPow</a></li><li data-type='method'><a href="BigFraction.html#operatorSub">operatorSub</a></li><li data-type='method'><a href="BigFraction.html#pow">pow</a></li><li data-type='method'><a href="BigFraction.html#sin">sin</a></li><li data-type='method'><a href="BigFraction.html#sinh">sinh</a></li><li data-type='method'><a href="BigFraction.html#sqrt">sqrt</a></li><li data-type='method'><a href="BigFraction.html#sub">sub</a></li><li data-type='method'><a href="BigFraction.html#tan">tan</a></li><li data-type='method'><a href="BigFraction.html#tanh">tanh</a></li><li data-type='method'><a href="BigFraction.html#toBigFloat">toBigFloat</a></li><li data-type='method'><a href="BigFraction.html#toNumber">toNumber</a></li><li data-type='method'><a href="BigFraction.html#toString">toString</a></li><li data-type='method'><a href="BigFraction.html#.fromString">fromString</a></li></ul></li><li><a href="BigFraction_BigFraction.html">BigFraction</a></li><li><a href="Complex.html">Complex</a><ul class='methods'><li data-type='method'><a href="Complex.html#abs">abs</a></li><li data-type='method'><a href="Complex.html#acos">acos</a></li><li data-type='method'><a href="Complex.html#acosh">acosh</a></li><li data-type='method'><a href="Complex.html#add">add</a></li><li data-type='method'><a href="Complex.html#arg">arg</a></li><li data-type='method'><a href="Complex.html#asin">asin</a></li><li data-type='method'><a href="Complex.html#asinh">asinh</a></li><li data-type='method'><a href="Complex.html#atan">atan</a></li><li data-type='method'><a href="Complex.html#atanh">atanh</a></li><li data-type='method'><a href="Complex.html#conj">conj</a></li><li data-type='method'><a href="Complex.html#cos">cos</a></li><li data-type='method'><a href="Complex.html#cosh">cosh</a></li><li data-type='method'><a href="Complex.html#div">div</a></li><li data-type='method'><a href="Complex.html#equals">equals</a></li><li data-type='method'><a href="Complex.html#exp">exp</a></li><li data-type='method'><a href="Complex.html#isAlmostZero">isAlmostZero</a></li><li data-type='method'><a href="Complex.html#isZero">isZero</a></li><li data-type='method'><a href="Complex.html#log">log</a></li><li data-type='method'><a href="Complex.html#mul">mul</a></li><li data-type='method'><a href="Complex.html#neg">neg</a></li><li data-type='method'><a href="Complex.html#pow">pow</a></li><li data-type='method'><a href="Complex.html#sin">sin</a></li><li data-type='method'><a href="Complex.html#sinh">sinh</a></li><li data-type='method'><a href="Complex.html#sqrt">sqrt</a></li><li data-type='method'><a href="Complex.html#sub">sub</a></li><li data-type='method'><a href="Complex.html#tan">tan</a></li><li data-type='method'><a href="Complex.html#tanh">tanh</a></li><li data-type='method'><a href="Complex.html#toString">toString</a></li><li data-type='method'><a href="Complex.html#.fromPolar">fromPolar</a></li><li data-type='method'><a href="Complex.html#.fromString">fromString</a></li></ul></li><li><a href="Poly.html">Poly</a><ul class='methods'><li data-type='method'><a href="Poly.html#acos">acos</a></li><li data-type='method'><a href="Poly.html#add">add</a></li><li data-type='method'><a href="Poly.html#asin">asin</a></li><li data-type='method'><a href="Poly.html#atan">atan</a></li><li data-type='method'><a href="Poly.html#cos">cos</a></li><li data-type='method'><a href="Poly.html#degree">degree</a></li><li data-type='method'><a href="Poly.html#deriv">deriv</a></li><li data-type='method'><a href="Poly.html#div">div</a></li><li data-type='method'><a href="Poly.html#equals">equals</a></li><li data-type='method'><a href="Poly.html#eval">eval</a></li><li data-type='method'><a href="Poly.html#exp">exp</a></li><li data-type='method'><a href="Poly.html#integ">integ</a></li><li data-type='method'><a href="Poly.html#log">log</a></li><li data-type='method'><a href="Poly.html#mul">mul</a></li><li data-type='method'><a href="Poly.html#neg">neg</a></li><li data-type='method'><a href="Poly.html#operatorAdd">operatorAdd</a></li><li data-type='method'><a href="Poly.html#operatorDiv">operatorDiv</a></li><li data-type='method'><a href="Poly.html#operatorMul">operatorMul</a></li><li data-type='method'><a href="Poly.html#operatorNeg">operatorNeg</a></li><li data-type='method'><a href="Poly.html#operatorPow">operatorPow</a></li><li data-type='method'><a href="Poly.html#operatorSub">operatorSub</a></li><li data-type='method'><a href="Poly.html#pow">pow</a></li><li data-type='method'><a href="Poly.html#powSeries">powSeries</a></li><li data-type='method'><a href="Poly.html#sin">sin</a></li><li data-type='method'><a href="Poly.html#sub">sub</a></li><li data-type='method'><a href="Poly.html#tan">tan</a></li><li data-type='method'><a href="Poly.html#toString">toString</a></li><li data-type='method'><a href="Poly.html#valuation">valuation</a></li><li data-type='method'><a href="Poly.html#.O">O</a></li><li data-type='method'><a href="Poly.html#.X">X</a></li></ul></li><li><a href="Scalar.html">Scalar</a><ul class='methods'><li data-type='method'><a href="Scalar.html#abs">abs</a></li><li data-type='method'><a href="Scalar.html#acos">acos</a></li><li data-type='method'><a href="Scalar.html#acosh">acosh</a></li><li data-type='method'><a href="Scalar.html#add">add</a></li><li data-type='method'><a href="Scalar.html#asin">asin</a></li><li data-type='method'><a href="Scalar.html#asinh">asinh</a></li><li data-type='method'><a href="Scalar.html#atan">atan</a></li><li data-type='method'><a href="Scalar.html#atanh">atanh</a></li><li data-type='method'><a href="Scalar.html#cmp">cmp</a></li><li data-type='method'><a href="Scalar.html#cos">cos</a></li><li data-type='method'><a href="Scalar.html#cosh">cosh</a></li><li data-type='method'><a href="Scalar.html#div">div</a></li><li data-type='method'><a href="Scalar.html#equals">equals</a></li><li data-type='method'><a href="Scalar.html#exp">exp</a></li><li data-type='method'><a href="Scalar.html#isAlmostZero">isAlmostZero</a></li><li data-type='method'><a href="Scalar.html#isZero">isZero</a></li><li data-type='method'><a href="Scalar.html#log">log</a></li><li data-type='method'><a href="Scalar.html#mul">mul</a></li><li data-type='method'><a href="Scalar.html#neg">neg</a></li><li data-type='method'><a href="Scalar.html#operatorAdd">operatorAdd</a></li><li data-type='method'><a href="Scalar.html#operatorDiv">operatorDiv</a></li><li data-type='method'><a href="Scalar.html#operatorMul">operatorMul</a></li><li data-type='method'><a href="Scalar.html#operatorNeg">operatorNeg</a></li><li data-type='method'><a href="Scalar.html#operatorPow">operatorPow</a></li><li data-type='method'><a href="Scalar.html#operatorSub">operatorSub</a></li><li data-type='method'><a href="Scalar.html#pow">pow</a></li><li data-type='method'><a href="Scalar.html#sin">sin</a></li><li data-type='method'><a href="Scalar.html#sinh">sinh</a></li><li data-type='method'><a href="Scalar.html#sqrt">sqrt</a></li><li data-type='method'><a href="Scalar.html#sub">sub</a></li><li data-type='method'><a href="Scalar.html#tan">tan</a></li><li data-type='method'><a href="Scalar.html#tanh">tanh</a></li><li data-type='method'><a href="Scalar.html#toString">toString</a></li><li data-type='method'><a href="Scalar.html#.fromString">fromString</a></li><li data-type='method'><a href="Scalar.html#.getLevel">getLevel</a></li><li data-type='method'><a href="Scalar.html#.promote">promote</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#E">E</a></li><li><a href="global.html#Flags">Flags</a></li><li><a href="global.html#O">O</a></li><li><a href="global.html#PI">PI</a></li><li><a href="global.html#X">X</a></li><li><a href="global.html#abs">abs</a></li><li><a href="global.html#acos">acos</a></li><li><a href="global.html#asin">asin</a></li><li><a href="global.html#atan">atan</a></li><li><a href="global.html#atan2">atan2</a></li><li><a href="global.html#bf">bf</a></li><li><a href="global.html#bigIntSqrt">bigIntSqrt</a></li><li><a href="global.html#ceil">ceil</a></li><li><a href="global.html#complex">complex</a></li><li><a href="global.html#cos">cos</a></li><li><a href="global.html#decimal_precision">decimal_precision</a></li><li><a href="global.html#exp">exp</a></li><li><a href="global.html#floor">floor</a></li><li><a href="global.html#fminbnd">fminbnd</a></li><li><a href="global.html#formatDecimal">formatDecimal</a></li><li><a href="global.html#fpround">fpround</a></li><li><a href="global.html#frac">frac</a></li><li><a href="global.html#fromDouble">fromDouble</a></li><li><a href="global.html#fzero">fzero</a></li><li><a href="global.html#gc_ele_limit">gc_ele_limit</a></li><li><a href="global.html#gcd">gcd</a></li><li><a href="global.html#globalFlag">globalFlag</a></li><li><a href="global.html#half">half</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#is_ready">is_ready</a></li><li><a href="global.html#libbf">libbf</a></li><li><a href="global.html#log">log</a></li><li><a href="global.html#max">max</a></li><li><a href="global.html#minus_one">minus_one</a></li><li><a href="global.html#neg">neg</a></li><li><a href="global.html#ode45">ode45</a></li><li><a href="global.html#one">one</a></li><li><a href="global.html#poly">poly</a></li><li><a href="global.html#polyStr">polyStr</a></li><li><a href="global.html#polyfit">polyfit</a></li><li><a href="global.html#polyval">polyval</a></li><li><a href="global.html#pop_precision">pop_precision</a></li><li><a href="global.html#pow">pow</a></li><li><a href="global.html#precision">precision</a></li><li><a href="global.html#push_decimal_precision">push_decimal_precision</a></li><li><a href="global.html#push_precision">push_precision</a></li><li><a href="global.html#romberg">romberg</a></li><li><a href="global.html#roots">roots</a></li><li><a href="global.html#round">round</a></li><li><a href="global.html#scalar">scalar</a></li><li><a href="global.html#setGlobalFlag">setGlobalFlag</a></li><li><a href="global.html#setPrecision">setPrecision</a></li><li><a href="global.html#setThrowExceptionOnInvalidOp">setThrowExceptionOnInvalidOp</a></li><li><a href="global.html#set_gc_ele_limit">set_gc_ele_limit</a></li><li><a href="global.html#sign">sign</a></li><li><a href="global.html#sin">sin</a></li><li><a href="global.html#solveLinearSystem">solveLinearSystem</a></li><li><a href="global.html#sqrt">sqrt</a></li><li><a href="global.html#tan">tan</a></li><li><a href="global.html#three">three</a></li><li><a href="global.html#throwExceptionOnInvalidOp">throwExceptionOnInvalidOp</a></li><li><a href="global.html#trunc">trunc</a></li><li><a href="global.html#two">two</a></li><li><a href="global.html#zero">zero</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">frac.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { bf, BigFloat } from "./bf.js";

/**
 * Helper function to calculate Greatest Common Divisor (GCD) using Euclidean algorithm.
 * @param {bigint} a 
 * @param {bigint} b 
 * @returns {bigint}
 */
const gcd = (a, b) => {
    return b === 0n ? a : gcd(b, a % b);
};


/**
 * Calculates the integer square root of a BigInt.
 * Returns undefined if the value is negative or not a perfect square.
 * @param {bigint} value 
 * @returns {bigint|undefined}
 */
const bigIntSqrt = (value) => {
    // Return undefined for negative inputs as they have no real square root
    if (value &lt; 0n) return undefined;
    if (value &lt; 2n) return value;

    let x0 = value;
    let x1 = (x0 + value / x0) >> 1n;

    // Newton's method for integer square root
    while (x1 &lt; x0) {
        x0 = x1;
        x1 = (x0 + value / x0) >> 1n;
    }

    // Check if the result is a perfect square
    // BigInt division truncates, so we must verify by squaring the result
    return (x0 * x0 === value) ? x0 : undefined;
};



// ==========================================
// Performance Helpers (Module Level)
// ==========================================

// Shared buffers to avoid allocation overhead on every instantiation.
const _buf = new ArrayBuffer(8);
const _f64 = new Float64Array(_buf);
const _u64 = new BigUint64Array(_buf);

/**
 * Rapidly converts a JS Number to BigInt numerator and denominator
 * by directly accessing IEEE 754 bits.
 * 
 * Formula: Value = (-1)^S * (1 + Mantissa/2^52) * 2^(Exponent - 1023)
 * @param {number} val
 * @returns {{n: bigint, d: bigint}}
 */
const fromDouble = (val) => {
    _f64[0] = val;
    const bits = _u64[0];

    // Extract IEEE 754 components
    const sign = (bits >> 63n) ? -1n : 1n;
    const exponent = (bits >> 52n) &amp; 0x7FFn;
    let mantissa = bits &amp; 0xFFFFFFFFFFFFFn;

    // Handle 0
    if (exponent === 0n &amp;&amp; mantissa === 0n) {
        return { n: 0n, d: 1n };
    }

    // Handle Subnormals (exponent = 0) vs Normals
    let shift;
    if (exponent === 0n) {
        // Subnormal: val = mantissa * 2^(1 - 1023 - 52)
        // exp is effectively -1022, mantissa has no implicit leading 1
        shift = 1n - 1023n - 52n; 
    } else {
        // Normal: val = (1.mantissa) * 2^(exponent - 1023)
        // We treat 1.mantissa as (1&lt;&lt;52 + mantissa) * 2^-52
        mantissa |= 0x10000000000000n; // Add implicit leading 1
        shift = exponent - 1023n - 52n;
    }

    // Construct Numerator and Denominator based on shift (exponent)
    let num, den;
    if (shift >= 0n) {
        // Number is integer or large: 5.0 -> 5 * 2^0
        num = mantissa &lt;&lt; shift;
        den = 1n;
    } else {
        // Number is fraction: 0.5 -> 1 * 2^-1
        num = mantissa;
        den = 1n &lt;&lt; (-shift);
    }

    // Apply Sign
    if (sign &lt; 0n) num = -num;

    return { n: num, d: den };
};


/**
 * @class BigFraction
 * @description A class for arbitrary-precision rational number arithmetic.
 */
export class BigFraction {
    /**
     * Optimized Constructor.
     * 
     * Supports:
     * 1. Number (Float): Uses bitwise extraction (Fastest, Exact).
     * 2. Number (Integer): Direct BigInt conversion.
     * 3. String: "1.5", "1/2", "-5".
     * 4. BigInt / BigFraction.
     * @param {BigFraction | bigint | number | string} [n] - The numerator or the whole value.
     * @param {bigint | number | string} [d] - The denominator.
     */
    constructor(n, d) {
        // 1. Handle Copy Constructor
        if (n instanceof BigFraction) {
            this.n = n.n;
            this.d = n.d;
            return;
        }

        let num = 0n;
        let den = 1n;

        // 2. Identify Input Type
        const typeN = typeof n;

        if (typeN === 'bigint') {
            num = n;
            den = (d !== undefined) ? BigInt(d) : 1n;
        } 
        else if (typeN === 'number') {
            if (Number.isInteger(n)) {
                // Fast path for integers
                num = BigInt(n);
                den = (d !== undefined) ? BigInt(d) : 1n;
            } else if (!Number.isFinite(n)) {
                 // NaN or Infinity
                this.n = 0n; 
                this.d = 0n; // Mark as NaN
                return;
            } else {
                // Fast bitwise float extraction (No strings)
                const res = fromDouble(n);
                num = res.n;
                den = res.d;
                // Note: 'd' argument is ignored when n is a float, 
                // as a float contains its own denominator data.
            }
        } 
        else if (typeN === 'string') {
            // String Parsing
            if (n.includes('/')) {
                const parts = n.split('/');
                num = BigInt(parts[0]);
                den = BigInt(parts[1]);
            } else if (n.includes('.')) {
                const [intPart, fracPart] = n.split('.');
                num = BigInt(intPart + fracPart);
                den = 10n ** BigInt(fracPart.length);
            } else {
                num = BigInt(n);
                den = 1n;
            }
            
            // If second arg provided for string (rare case: new Fraction("1", "2"))
            if (d !== undefined) {
                const den2 = BigInt(d);
                den = den * den2;
            }
        } 
        else {
            // Default / Empty
            num = 0n;
            den = 1n;
        }

        // 3. Normalization &amp; Simplification
        if (den === 0n) {
            this.n = 0n;
            this.d = 0n; // NaN
        } else {
            if (den &lt; 0n) {
                num = -num;
                den = -den;
            }
            // Simplify using GCD
            // Note: Binary conversion of floats often produces large even numbers,
            // so GCD is crucial here.
            const common = gcd(num > 0n ? num : -num, den);
            this.n = num / common;
            this.d = den / common;
        }
    }

    // ===========================
    // Core Arithmetic Methods
    // ===========================

    /**
     * Adds another fraction.
     * @param {BigFraction|bigint|number|string} b 
     * @returns {BigFraction} New Fraction instance
     */
    add(b) {
        const other = new BigFraction(b);
        // a/b + c/d = (ad + bc) / bd
        return new BigFraction(
            this.n * other.d + other.n * this.d,
            this.d * other.d
        );
    }

    /**
     * Subtracts another fraction.
     * @param {BigFraction|bigint|number|string} b 
     * @returns {BigFraction}
     */
    sub(b) {
        const other = new BigFraction(b);
        // a/b - c/d = (ad - bc) / bd
        return new BigFraction(
            this.n * other.d - other.n * this.d,
            this.d * other.d
        );
    }

    /**
     * Multiplies by another fraction.
     * @param {BigFraction|bigint|number|string} b 
     * @returns {BigFraction}
     */
    mul(b) {
        const other = new BigFraction(b);
        return new BigFraction(
            this.n * other.n,
            this.d * other.d
        );
    }

    /**
     * Divides by another fraction.
     * @param {BigFraction|bigint|number|string} b 
     * @returns {BigFraction}
     */
    div(b) {
        const other = new BigFraction(b);
        if (other.isZero()) throw new Error("Division by zero");
        // (a/b) / (c/d) = ad / bc
        return new BigFraction(
            this.n * other.d,
            this.d * other.n
        );
    }

    /**
     * Returns the integer square root of the fraction (floor(sqrt(value))).
     * Since BigInt arithmetic is integer based, exact rational roots are rare.
     * This returns a Fraction representing the integer root.
     * @returns {BigFraction|undefined}
     */
    sqrt() {
        if (this.n &lt; 0n) throw new Error("Square root of negative number");
        // We calculate the integer square root of the simplified value (n/d)
        const val = this.n / this.d;
        let s=bigIntSqrt(val);
        return s===undefined?undefined:new BigFraction(s, 1n);
    }

    /**
     * Raises fraction to an integer power.
     * @param {number|bigint|BigFraction} exponent 
     * @returns {BigFraction|undefined}
     */
    pow(exponent) {        
        if(typeof(exponent)==="bigint"){
            //nothing
        }else if(exponent instanceof BigFraction){
            if(exponent.n === 0n || exponent.d===1n){
                exponent = exponent.n;
            }else{
                return undefined;
            }
        }else if(typeof(exponent)==="number"){
            if(Number.isInteger(exponent)){
                exponent=BigInt(exponent);
            }else{
                return undefined;
            }
        }

        let exp = exponent;
        if (exp === 0n) return new BigFraction(1n);

        let num = this.n;
        let den = this.d;

        if (exp &lt; 0n) {
            // Invert if negative exponent
            let temp = num;
            num = den;
            den = temp;
            exp = -exp;
        }

        // Apply power
        return new BigFraction(num ** exp, den ** exp);
    }

    /**
     * Returns the floor of the fraction (largest integer &lt;= value).
     * @returns {BigFraction}
     */
    floor() {
        if (this.d === 0n) return this;
        let res = this.n / this.d;
        // Handling negative numbers: -3/2 = -1.5 -> floor is -2
        // Integer division in JS truncates towards zero (-1), so we need adjustment
        if (this.n &lt; 0n &amp;&amp; (this.n % this.d !== 0n)) {
            res -= 1n;
        }
        return new BigFraction(res, 1n);
    }

    /**
     * Negates the value.
     * @returns {BigFraction}
     */
    neg() {
        return new BigFraction(-this.n, this.d);
    }

    /**
     * Returns the absolute value.
     * @returns {BigFraction}
     */
    abs() {
        return new BigFraction(this.n &lt; 0n ? -this.n : this.n, this.d);
    }


    /**
     * Returns e^this. Placeholder, not implemented.
     * @returns {BigFraction|undefined}
     */
    exp() {
        if (this.n === 0n) return new BigFraction(1n);
        return undefined;
    }

    /**
     * Returns log(this). Placeholder, not implemented.
     * @returns {BigFraction|undefined}
     */
    log() {
        if (this.n === this.d &amp;&amp; this.d !== 0n) return new BigFraction(0n);
        return undefined;
    }

    /**
     * Returns sin(this). Placeholder, not implemented.
     * @returns {BigFraction|undefined}
     */
    sin() {
        if (this.n === 0n) return new BigFraction(0n);
        return undefined;
    }

    /**
     * Returns cos(this). Placeholder, not implemented.
     * @returns {BigFraction|undefined}
     */
    cos() {
        if (this.n === 0n) return new BigFraction(1n);
        return undefined;
    }

    /**
     * Returns tan(this). Placeholder, not implemented.
     * @returns {BigFraction|undefined}
     */
    tan() {
        if (this.n === 0n) return new BigFraction(0n);
        return undefined;
    }

    /**
     * Returns asin(this). Placeholder, not implemented.
     * @returns {BigFraction|undefined}
     */
    asin() {
        if (this.n === 0n) return new BigFraction(0n);
        return undefined;
    }

    /**
     * Returns acos(this). Placeholder, not implemented.
     * @returns {BigFraction|undefined}
     */
    acos() {
        if (this.n === this.d &amp;&amp; this.d !== 0n) return new BigFraction(0n);
        return undefined;
    }

    /**
     * Returns atan(this). Placeholder, not implemented.
     * @returns {BigFraction|undefined}
     */
    atan() {
        if (this.n === 0n) return new BigFraction(0n);
        return undefined;
    }

    /**
     * Returns sinh(this). Placeholder, not implemented.
     * @returns {BigFraction|undefined}
     */
    sinh() {
        if (this.n === 0n) return new BigFraction(0n);
        return undefined;
    }

    /**
     * Returns cosh(this). Placeholder, not implemented.
     * @returns {BigFraction|undefined}
     */
    cosh() {
        if (this.n === 0n) return new BigFraction(1n);
        return undefined;
    }

    /**
     * Returns tanh(this). Placeholder, not implemented.
     * @returns {BigFraction|undefined}
     */
    tanh() {
        if (this.n === 0n) return new BigFraction(0n);
        return undefined;
    }

    /**
     * Returns asinh(this). Placeholder, not implemented.
     * @returns {BigFraction|undefined}
     */
    asinh() {
        if (this.n === 0n) return new BigFraction(0n);
        return undefined;
    }

    /**
     * Returns acosh(this). Placeholder, not implemented.
     * @returns {BigFraction|undefined}
     */
    acosh() {
        if (this.n === this.d &amp;&amp; this.d !== 0n) return new BigFraction(0n);
        return undefined;
    }

    /**
     * Returns atanh(this). Placeholder, not implemented.
     * @returns {BigFraction|undefined}
     */
    atanh() {
        if (this.n === 0n) return new BigFraction(0n);
        return undefined;
    }    

    // ===========================
    // Status &amp; Conversion
    // ===========================

    /**
     * Checks if the fraction is technically invalid (denominator was 0).
     * @returns {boolean}
     */
    isNaN() {
        return this.d === 0n;
    }

    /**
     * Checks if the value is zero.
     * @returns {boolean}
     */
    isZero() {
        return this.n === 0n &amp;&amp; this.d !== 0n;
    }
    
    /**
     * Checks if the value is zero.
     * @returns {boolean}
     */
    isAlmostZero() {
        return this.n === 0n &amp;&amp; this.d !== 0n;
    }

    /**
     * @returns {BigFloat}
     */
    toBigFloat() {
        return bf(this.n).div(bf(this.d));
    }

    /**
     * Converts to a standard JavaScript number (may lose precision).
     * @returns {number}
     */
    toNumber() {
        if (this.d === 0n) return NaN;
        // Convert to number explicitly
        return Number(this.n) / Number(this.d);
    }

    /**
     * Parses a string to create a fraction.
     * Supports integers "123", fractions "1/2", and decimals "1.5".
     * @param {string} str 
     * @returns {BigFraction}
     */
    static fromString(str) {
        if (typeof(str)!="string"){
            throw new Error("not a string");
        }
        return new BigFraction(str);
    }

    /**
     * Converts to string.
	 * @param {number} [radix=10] 
	 * @param {number} [prec=-1] precision digits in radix
	 * @param {boolean} [pretty=false] pretty print
     * @returns {string}
     */
    toString(radix = 10, prec=-1,pretty=false) {
        if (this.d === 1n){
            return this.n.toString(radix, prec, pretty);
        }
        return `${this.n.toString(radix, prec, pretty)}/${this.d.toString(radix, prec, pretty)}`;
    }

    // ===========================
    // Comparisons
    // ===========================

    /**
     * Compares with another value.
     * @param {BigFraction|bigint|number|string} b 
     * @returns {number} -1 if less, 0 if equal, 1 if greater.
     */
    cmp(b) {
        const other = b instanceof BigFraction ? b : new BigFraction(b);
        // Compare n1/d1 vs n2/d2 &lt;=> n1*d2 vs n2*d1
        const left = this.n * other.d;
        const right = other.n * this.d;

        if (left &lt; right) return -1;
        if (left > right) return 1;
        return 0;
    }

    /**
     * @param {BigFraction|bigint|number|string} b 
     * @returns {boolean}
     */
    equals(b){
        return this.cmp(b)==0;
    }

    /**
     * @param {BigFraction|bigint|number|string} b 
     * @returns {boolean}
     */
    operatorLess(b) {
        return this.cmp(b) === -1;
    }

    /**
     * @param {BigFraction|bigint|number|string} b 
     * @returns {boolean}
     */
    operatorGreater(b) {
        return this.cmp(b) === 1;
    }

    /**
     * @param {BigFraction|bigint|number|string} b 
     * @returns {boolean}
     */
    operatorLessEqual(b) {
        return this.cmp(b) &lt;= 0;
    }

    /**
     * @param {BigFraction|bigint|number|string} b 
     * @returns {boolean}
     */
    operatorGreaterEqual(b) {
        return this.cmp(b) >= 0;
    }

    /**
     * @param {BigFraction|bigint|number|string} b 
     * @returns {boolean}
     */
    operatorEqual(b) {
        return this.cmp(b) === 0;
    }

    /**
     * @param {BigFraction|bigint|number|string} b 
     * @returns {boolean}
     */
    operatorNotEqual(b) {
        return this.cmp(b) !== 0;
    }

    /**
     * @param {BigFraction|bigint|number|string} b 
     * @returns {BigFraction}
     */
    operatorAdd(b) { return this.add(b); }
    /**
     * @param {BigFraction|bigint|number|string} b 
     * @returns {BigFraction}
     */
    operatorSub(b) { return this.sub(b); }
    /**
     * @param {BigFraction|bigint|number|string} b 
     * @returns {BigFraction}
     */
    operatorMul(b) { return this.mul(b); }
    /**
     * @param {BigFraction|bigint|number|string} b 
     * @returns {BigFraction}
     */
    operatorDiv(b) { return this.div(b); }
    /**
     * @param {number|bigint|BigFraction} b 
     * @returns {BigFraction|undefined}
     */
    operatorPow(b) { return this.pow(b); }
    /**
     * @returns {BigFraction}
     */
    operatorNeg() { return this.neg(); }
}

/**
 * Creates a new BigFraction instance.
 * @param {BigFraction | bigint | number | string} [n] - The numerator or the whole value.
 * @param {bigint | number | string} [d=1n] - The denominator.
 * @returns {BigFraction}
 */
export function frac(n,d=1n){
    return new BigFraction(n,d);
}</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> on Mon Feb 16 2026 13:49:12 GMT+0800 (中国标准时间) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
